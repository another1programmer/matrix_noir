<!doctype html>
<html lang="ru">
<head>
   <base href="./">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Matrix Cat: Office Noir ‚Äî Prototype</title>
   <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

<div id="disclaimer" class="disclaimer" style="display:none;">
    <div class="disclaimer-content">
        <div id="disclaimerText" class="disclaimer-text"></div>
     
<button id="disclaimerBtn" class="disclaimer-btn">–û–∑–Ω–∞–∫–æ–º–ª–µ–Ω</button>

    </div>
</div>




<div id="doorLock" class="door-lock" style="display:none;">
  <div class="lock-overlay"></div>
  <div class="lock-container">
    <h2>–î–≤–µ—Ä—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞</h2>
    <p class="lock-hint">–ó–∞–∂–º–∏—Ç–µ —Ç—Ä–∏ —Ü–∏—Ñ—Ä—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>
    <div class="lock-buttons">
      <button class="lock-btn" data-digit="1">1</button>
      <button class="lock-btn" data-digit="2">2</button>
      <button class="lock-btn" data-digit="3">3</button>
      <button class="lock-btn" data-digit="4">4</button>
      <button class="lock-btn" data-digit="5">5</button>
      <button class="lock-btn" data-digit="6">6</button>
      <button class="lock-btn" data-digit="7">7</button>
      <button class="lock-btn" data-digit="8">8</button>
      <button class="lock-btn" data-digit="9">9</button>
      <button class="lock-btn" data-digit="0">0</button>
    </div>
    <p class="lock-status"></p>
  </div>
</div>


<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
  }
}
</script>
  <style>

    
.transition-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: #000;
  opacity: 0;
  pointer-events: none;
  z-index: 10000; 
  transition: opacity 1s ease-in-out;
}

.transition-overlay.active {
  opacity: 1;
  pointer-events: all; 
}


#coffeeGame {
  display: none;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  justify-content: center;
  align-items: center;
  z-index: 9999 !important;
}

#coffeeGame .coffee-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.92);
  backdrop-filter: blur(10px);
}

#coffeeGame .coffee-container {
  position: relative;
  background: linear-gradient(145deg, #2a2420, #1a1410);
  border: 3px solid var(--accent);
  border-radius: 20px;
  padding: 40px;
  text-align: center;
  box-shadow: 0 0 50px rgba(255, 217, 59, 0.4);
  max-width: 700px;
  width: 90%;
}

#coffeeGame h2 {
  color: var(--accent);
  margin-bottom: 10px;
  font-size: 28px;
}

#coffeeGame .coffee-hint {
  color: #ffd93b;
  font-size: 16px;
  margin-bottom: 30px;
  min-height: 24px;
}

#coffeeGame .coffee-cup-area {
  position: relative;
  width: 200px;
  height: 250px;
  margin: 0 auto 40px;
  display: flex;
  justify-content: center;
  align-items: center;
}

#coffeeGame .coffee-cup {
  width: 180px;
  height: 220px;
  object-fit: contain;
  transition: transform 0.3s ease;
  position: relative;
  z-index: 2;
}

#coffeeGame .cup-glow {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 220px;
  height: 260px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255, 217, 59, 0) 0%, rgba(255, 217, 59, 0) 70%);
  pointer-events: none;
  z-index: 1;
  transition: all 0.3s ease;
}

#coffeeGame .cup-glow.active {
  background: radial-gradient(circle, rgba(255, 217, 59, 0.3) 0%, rgba(255, 217, 59, 0) 70%);
  box-shadow: 0 0 40px rgba(255, 217, 59, 0.6);
}

#coffeeGame .coffee-ingredients {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

#coffeeGame .ingredient {
  width: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: grab;
  transition: all 0.3s ease;
  opacity: 1;
}

#coffeeGame .ingredient:active {
  cursor: grabbing;
}

#coffeeGame .ingredient.used {
  opacity: 0.3;
  pointer-events: none;
  filter: grayscale(100%);
}

#coffeeGame .ingredient img {
  width: 80px;
  height: 80px;
  object-fit: contain;
  margin-bottom: 8px;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
  transition: transform 0.2s ease;
}

#coffeeGame .ingredient:hover img {
  transform: scale(1.1);
}

#coffeeGame .ingredient span {
  color: #ccc;
  font-size: 12px;
  text-transform: uppercase;
}

#coffeeGame .coffee-status {
  color: var(--accent);
  font-size: 18px;
  font-weight: bold;
}

#coffeeGame #coffeeProgress {
  color: #4ade80;
}

#coffeeGame .coffee-cup.pour {
  animation: pourIngredient 0.5s ease;
}

@keyframes pourIngredient {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
  20%, 40%, 60%, 80% { transform: translateX(8px); }
}



.door-lock {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.lock-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(8px);
}


.lock-container {
  position: relative;
  background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
  border: 3px solid var(--accent);
  border-radius: 20px;
  padding: 40px;
  text-align: center;
  box-shadow: 0 0 50px rgba(255, 217, 59, 0.4);
  max-width: 500px;
}

.lock-container h2 {
  color: var(--accent);
  margin-bottom: 10px;
  font-size: 28px;
}

.lock-hint {
  color: #999;
  font-size: 14px;
  margin-bottom: 30px;
}


.lock-buttons {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 15px;
  margin-bottom: 20px;
}

.lock-btn {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: linear-gradient(145deg, #4a4a4a, #2a2a2a);
  border: 2px solid #555;
  color: #fff;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.15s ease;
  box-shadow: 
    0 4px 8px rgba(0, 0, 0, 0.5),
    inset 0 -2px 5px rgba(0, 0, 0, 0.3);
  user-select: none;
}


.lock-btn:hover {
  background: linear-gradient(145deg, #5a5a5a, #3a3a3a);
  border-color: var(--accent);
  box-shadow: 
    0 0 20px rgba(255, 217, 59, 0.5),
    0 4px 8px rgba(0, 0, 0, 0.5);
}


.lock-btn.pressed {
  background: linear-gradient(145deg, #ffd93b, #f0c020);
  color: #000;
  border-color: #ffd93b;
  transform: translateY(4px);
  box-shadow: 
    0 0 30px rgba(255, 217, 59, 0.8),
    inset 0 2px 5px rgba(0, 0, 0, 0.4);
}


.lock-status {
  color: var(--accent);
  font-size: 16px;
  min-height: 24px;
}
  

.minigame-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    backdrop-filter: blur(5px);
}

.safeCrack-window {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    border: 3px solid var(--accent);
    border-radius: 12px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 40px rgba(255, 217, 59, 0.2);
    text-align: center;
}

.safeCrack-window h2 {
    font-family: var(--font);
    font-size: 28px;
    color: var(--accent);
    margin: 0 0 40px 0;
    text-transform: uppercase;
    letter-spacing: 2px;
}


.combination-container {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-bottom: 30px;
}


.disk-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}


.disk-arrow {
    width: 60px;
    height: 40px;
    background: rgba(255, 217, 59, 0.1);
    border: 2px solid var(--accent);
    border-radius: 6px;
    color: var(--accent);
    font-size: 20px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: Arial, sans-serif;
}

.disk-arrow:hover {
    background: var(--accent);
    color: #0a0a0a;
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(255, 217, 59, 0.4);
}

.disk-arrow:active {
    transform: scale(0.95);
}


.digit-display {
    width: 80px;
    height: 100px;
    background: #0a0a0a;
    border: 3px solid rgba(255, 217, 59, 0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Courier New', monospace;
    font-size: 52px;
    font-weight: 700;
    color: rgba(255, 217, 59, 0.6);
    box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.8);
    cursor: pointer;
    transition: all 0.3s ease;
    user-select: none;
}

.digit-display:hover {
    border-color: rgba(255, 217, 59, 0.6);
}


.digit-display.active {
    border-color: #fff;
    color: var(--accent);
    box-shadow: 0 0 25px rgba(255, 217, 59, 0.8), inset 0 2px 10px rgba(0, 0, 0, 0.8);
    text-shadow: 0 0 15px rgba(255, 217, 59, 0.6);
}


.instruction {
    font-family: var(--font);
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 30px;
    padding: 15px;
    background: rgba(255, 217, 59, 0.05);
    border-radius: 6px;
    border: 1px solid rgba(255, 217, 59, 0.2);
}

.instruction strong {
    color: var(--accent);
}


.safeCrack-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

.safeCrack-buttons button {
    font-family: var(--font);
    font-size: 16px;
    font-weight: 600;
    padding: 14px 32px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.btn-primary {
    background: var(--accent);
    color: #0a0a0a;
    box-shadow: 0 4px 15px rgba(255, 217, 59, 0.4);
}

.btn-primary:hover {
    background: #fff;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 217, 59, 0.6);
}

.btn-secondary {
    background: transparent;
    color: var(--accent);
    border: 2px solid var(--accent);
}

.btn-secondary:hover {
    background: rgba(255, 217, 59, 0.1);
    transform: translateY(-2px);
}


@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

.shake {
    animation: shake 0.4s ease;
}



    .model-viewer {
  position: fixed;
  inset: 0;
  background-image: url('assets/img/background2.png'); 
  background-size: cover; 
  background-position: center;
  background-repeat: no-repeat;
  z-index: 100;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(8px);
}

.model-viewer.open {
  display: flex;
}

.model-canvas {
  width: 80vw;
  max-width: 900px;
  height: 65vh;
  border: 2px solid var(--neon);
  border-radius: 16px;
  background: 
    linear-gradient(rgba(20, 20, 20, 0.7), rgba(10, 10, 10, 0.9)),
    url('assets/img/pattern3.png') center/cover; 
  box-shadow: 0 0 40px rgba(255, 217, 59, 0.3);
}

.model-info {
  margin-top: 20px;
  text-align: center;
  max-width: 600px;
  
  
  background: rgba(50, 50, 40, 0.85); 
  padding: 12px 20px;
  border-radius: 12px;
  backdrop-filter: blur(10px); 
}


.model-info h2 {
  color: var(--neon);
  margin: 0 0 10px;
  font-size: 24px;
}

.model-info p {
  color: #ffd93b; 
  line-height: 1.5;
}

.model-close {
  position: absolute;
  top: 30px;
  right: 30px;
  padding: 14px 24px;
  background: var(--panel);
  border: 2px solid var(--neon);
  border-radius: 10px;
  color: var(--neon);
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
  z-index: 101;
}

.model-close:hover {
  background: var(--neon);
  color: #000;
  box-shadow: 0 0 20px var(--ring);
}

.model-hint {
  margin-top: 15px;
  font-size: 13px;
  color: var(--muted);
  opacity: 0.7;
}

    :root{
      --bg:#0b0b0d; --panel:#141418; --panel-2:#1b1b22; --text:#e7e7e7; --neon:#ffd93b; --muted:#8b8b95;
      --ring: rgba(255, 217, 59, .35);
    }
    html,body{height:100%;}
    body{margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--text);}
    .game-root{position:relative; width:100%; height:100vh; overflow:hidden;}
   



.scene {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}


.bg {
    position: absolute;
    width: 100%;
    height: 100%;
    background: #000 center/contain no-repeat;
    background-size: contain;
    background-position: center;
}

.bg::after {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(60% 60% at 50% 42%, transparent, rgba(0,0,0,.55));
    pointer-events: none;
}


.obj {
    position: absolute;
    transform: translate(-50%, -50%);
    
   
    pointer-events: none;
    
    display: inline-block;
    width: fit-content;
    height: fit-content;
    padding: 0;
    margin: 0;
    line-height: 0;
}

.obj img {
    max-width: 8vw;
    min-width: 40px;
    width: auto;
    height: auto;
    display: block;
    image-rendering: auto;
    
    
    pointer-events: auto;
    cursor: pointer;
    
    filter: drop-shadow(0 0 0 rgba(255,217,59,0));
    transition: filter .15s ease;
}

.obj img:hover {
    filter: drop-shadow(0 0 8px rgba(255,217,59,.7)) drop-shadow(0 0 16px rgba(255,217,59,.3));
}



@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
  20%, 40%, 60%, 80% { transform: translateX(8px); }
}



    .main-menu{position:absolute; inset:0; display:grid; place-items:center; background:#000 url('assets/img/menu_back2.jpg') center/cover no-repeat; z-index:50}
    .menu-card{background:rgba(20,20,24,.35); padding:14px 18px; border-radius:14px; width:min(520px, 92vw); box-shadow:0 12px 30px rgba(0,0,0,.45); backdrop-filter: blur(2px);}
    .menu-card h1{margin:0 0 6px; font-weight:750; letter-spacing:.5px}
    .menu-card p{margin:2px 0 12px; color:var(--text)}
    .menu-grid{display:grid; gap:8px}
    .menu-card a {
  color: #ffd93b;
  text-decoration: none;
  transition: 0.2s;
}

.menu-card a:hover {
  color: #fff;
  text-shadow: 0 0 8px rgba(255,217,59,0.6);
}

    .btn{appearance:none; border:0; border-radius:12px; padding:12px 14px; background:rgba(27,27,34,.55); color:var(--text); cursor:pointer; transition:.15s}
    .btn:hover{outline:2px solid var(--ring); background:rgba(27,27,34,.7)}
    .row{display:flex; gap:8px}
    input[type=text], select{width:100%; background:#101015; color:var(--text); border:1px solid #2a2a33; border-radius:10px; padding:10px 12px; box-sizing: border-box;}
    .hint{font-size:12px; color:#a1a1aa}
    .hud{position:absolute; top:16px; right:16px; display:flex; gap:10px; align-items:center; z-index:30}
  .icon-btn {
  background: rgba(20,20,24,.65);
  border: 1px solid #2a2a33;
  border-radius: 12px;
  padding: 10px 12px;
  cursor: pointer;
  opacity: .9;
  transform: scale(1.3);
  
  color: #ffd93b;
  filter: brightness(1.2);
}

.icon-btn:hover {
  outline: 2px solid var(--ring);
  filter: brightness(1.5);
}


    .inventory {
  position: absolute; 
  top: 16px; 
  left: 16px; 
  background: #2a1f14 url('assets/img/diplomat_leather.jpg') center/cover no-repeat; 
  border: 4px solid #3b2a1a; 
  border-radius: 16px; 
  width: 480px;  
  max-height: 85vh; 
  z-index: 25; 
  box-shadow: inset 0 0 40px rgba(0,0,0,.4), 0 10px 30px rgba(0,0,0,.5); 
  display: none;
  overflow: hidden;  
}

.inventory.open {
  display: block;
}

.inventory-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  border-bottom: 1px solid rgba(255, 217, 59, 0.2);
  gap: 10px;
}

.inventory-header strong {
  font-size: 18px;
  color: var(--neon);
}

.inventory-header .hint {
  font-size: 10px;
  color: #888;
  font-style: italic;
  flex: 1; 
}

.inventory-header .points {
  color: #ffd93b;
  font-weight: bold;
  font-size: 16px;
  text-shadow: 0 0 10px rgba(255, 217, 59, 0.6);
  white-space: nowrap; 
}


.grid {
  display: grid; 
  grid-template-columns: repeat(5, 1fr);  
  gap: 8px; 
  padding: 12px;
}

.cell {
  border: 1px solid rgba(255,255,255,.08); 
  aspect-ratio: 1/1;  
  border-radius: 10px; 
  display: flex;  
  align-items: center;  
  justify-content: center;  
  background: rgba(0,0,0,.15);
  padding: 5px;  
  box-sizing: border-box;
  position: relative;
}

.cell img {
  max-width: 100%;  
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain; 
  object-position: center;
  display: block;
}




.ctx {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    min-width: 280px;
    max-width: 420px;
    background: var(--panel);
    border: 1px solid #2a2a33;
    border-radius: 14px;
    padding: 16px;
    z-index: 40;
    box-shadow: 0 20px 60px rgba(0,0,0,0.7);
    pointer-events: auto; 
    will-change: transform; 
}


.ctx::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: -1;
    backdrop-filter: blur(4px);
    pointer-events: none; 
}

    .ctx h3{margin:0 0 6px; font-size:16px}
    .ctx p{margin:0 0 10px; color:var(--muted)}
    .ctx .row{justify-content:flex-end}
    .dialog{position:absolute; left:50%; bottom:24px; transform:translateX(-50%); width:min(960px, 88vw); display:flex; gap:12px; align-items:flex-start; z-index:35}
    .portrait{width:56px; height:56px; border-radius:50%; overflow:hidden; flex:0 0 auto; border:2px solid var(--neon); box-shadow:0 0 12px var(--ring)}
    .portrait img{width:100%; height:100%; object-fit:cover}
    .bubble{flex:1; background:var(--panel); border:1px solid #2a2a33; border-radius:14px; padding:12px 14px; box-shadow:0 10px 30px rgba(0,0,0,.45)}
    .typewriter{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; color:var(--neon); line-height:1.4}
    .choices{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap}
    .ep-title{position:absolute; inset:0; display:grid; place-items:center; z-index:45; pointer-events:none; opacity:0; transition:opacity .6s ease}
    .ep-title.show{opacity:1}
    .ep-pill{padding:10px 16px; border-radius:999px; background:rgba(0,0,0,.5); border:1px solid var(--ring); color:var(--neon); font-weight:600}
    .score-pop{position:absolute; left:50%; top:45%; transform:translate(-50%,-50%); color:var(--neon); font-weight:800; font-size:52px; opacity:0; animation: popFade 3.5s ease forwards}
    @keyframes popFade{0%{opacity:0; transform:translate(-50%,-50%) scale(.9)}20%{opacity:1; transform:translate(-50%,-50%) scale(1)}100%{opacity:0; transform:translate(-50%,-70%) scale(1.05)}}
    #goldDiggerBanner{position:fixed; left:50%; top:40%; transform:translate(-50%,-50%); font-size:56px; font-weight:900; color:#ffd700; text-shadow: 
    -2px -2px 0 #555,
    2px -2px 0 #555,
    -2px 2px 0 #555,
    2px 2px 0 #555,
    0 0 16px #ffef99, 
    0 0 28px #e0b500;
  letter-spacing: 3px;
  z-index: 100;
  opacity: 0;
  pointer-events: none;
  animation: goldFlash 1.8s ease-out forwards;
}
    @keyframes goldFlash{0%{opacity:0; transform:translate(-50%,-50%) scale(.9)}10%{opacity:1; transform:translate(-50%,-50%) scale(1)}60%{text-shadow:0 0 22px #fff3b0, 0 0 40px #ffc400}100%{opacity:0; transform:translate(-50%,-70%) scale(1.05)}}
    body.menu-open #scene, body.menu-open #hud, body.menu-open #dialog { visibility: hidden !important; }
body:not(.menu-open) #scene, body:not(.menu-open) #hud, body:not(.menu-open) #dialog { visibility: visible !important; }

    #mainMenu .menu-card h1, #mainMenu .menu-card p, #mainMenu .menu-card label, #mainMenu .menu-card .hint, #mainMenu .btn {text-shadow:-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;}
 @keyframes goldFlash{0%{opacity:0; transform:translate(-50%,-50%) scale(.9)}10%{opacity:1; transform:translate(-50%,-50%) scale(1)}60%{text-shadow:0 0 22px #fff3b0, 0 0 40px #ffc400}100%{opacity:0; transform:translate(-50%,-70%) scale(1.05)}}

@keyframes rarityFlash{0%{opacity:0;transform:translate(-50%,-50%) scale(0.8)}15%{opacity:1;transform:translate(-50%,-50%) scale(1.1)}85%{opacity:1;transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-70%) scale(0.9)}}

body.menu-open #scene, body.menu-open #hud, body.menu-open #dialog { visibility: hidden !important; }
body:not(.menu-open) #scene, body:not(.menu-open) #hud, body:not(.menu-open) #dialog { visibility: visible !important; }

#mainMenu .menu-card h1, #mainMenu .menu-card p, #mainMenu .menu-card label, #mainMenu .menu-card .hint, #mainMenu .btn {text-shadow:-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;}
.obj {
  position: absolute; 
  transform: translate(-50%,-50%); 
  cursor: pointer; 
  filter: drop-shadow(0 0 0 rgba(255,217,59,0)); 
  transition: filter .15s ease;
}

.obj:hover {
  filter: drop-shadow(0 0 12px rgba(255,217,59,.75)) drop-shadow(0 0 24px rgba(255,217,59,.35));
}


.obj img {
  max-width: 12vw;
  width: auto; 
  height: auto; 
  image-rendering: auto;
}

.ctx {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  min-width: 280px; 
  max-width: 420px;
  background: var(--panel); 
  border: 1px solid #2a2a33; 
  border-radius: 14px; 
  padding: 16px;
  z-index: 40;
  box-shadow: 0 20px 60px rgba(0,0,0,0.7);
}

.ctx h3 {
  margin: 0 0 6px;
  font-size: 16px;
}

.ctx p {
  margin: 0 0 10px;
  color: var(--muted);
}

.ctx .row {
  justify-content: flex-end;
}


.disclaimer {
    position: fixed;
    inset: 0;
    background: #0a0a0a;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.disclaimer.show {
    opacity: 1;
}


.disclaimer-content {
  display: flex;
  flex-direction: column;
  align-items: center; 
  text-align: center;
  gap: 20px;
}

.disclaimer-text {
    font-family: var(--font);
    font-size: 18px;
    line-height: 1.8;
    color: rgba(255, 255, 255, 0.85);
    margin-bottom: 60px;
    min-height: 200px;
}

.disclaimer-btn {
  margin: 20px auto 0; 
  display: block;
  opacity: 0; 
  transform: translateY(20px);
  transition: all 0.5s ease;
}

.disclaimer-btn.show {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

.disclaimer-btn:hover {
    background: var(--accent);  
    color: #ffd93b;  
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 217, 59, 0.6);
}


.disclaimer-btn:active {
    transform: scale(0.98);
}


#dialogText u {
  text-decoration: none;
  border-bottom: 2px solid #ffd93b;
  padding-bottom: 2px;
  text-shadow: 0 0 8px rgba(255, 217, 59, 0.4);
  color: #ffd93b !important;
}

.inventory-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

.inventory-header .points {
  color: #ffd93b;
  font-weight: bold;
  font-size: 14px;
  text-shadow: 0 0 10px rgba(255, 217, 59, 0.6);
  margin-left: auto; 
}

.inventory-header .hint {
  font-size: 10px;
  color: #888;
  font-style: italic;
}


.leaderboard-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.9);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
}

.leaderboard-container {
  background: linear-gradient(135deg, rgba(20, 20, 20, 0.95), rgba(40, 40, 40, 0.95));
  border: 2px solid var(--neon);
  border-radius: 16px;
  box-shadow: 0 0 40px rgba(255, 217, 59, 0.4);
  width: 90%;
  max-width: 800px;
  max-height: 80vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.leaderboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 2px solid var(--neon);
  background: rgba(0, 0, 0, 0.3);
}

.leaderboard-header h2 {
  margin: 0;
  color: var(--neon);
  font-size: 24px;
}

.leaderboard-content {
  padding: 20px;
  overflow-y: auto;
  flex: 1;
}

.close-btn {
  background: none;
  border: none;
  color: var(--neon);
  font-size: 30px;
  cursor: pointer;
  padding: 0;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s;
}

.close-btn:hover {
  background: rgba(255, 217, 59, 0.2);
  transform: rotate(90deg);
}

.leaderboard-content table {
  width: 100%;
  color: var(--text);
  border-collapse: collapse;
}

.leaderboard-content th {
  color: var(--neon);
  font-weight: bold;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 1px;
  padding: 10px;
  text-align: left;
  border-bottom: 2px solid var(--neon);
}

.leaderboard-content td {
  padding: 12px 10px;
  border-bottom: 1px solid rgba(255, 217, 59, 0.2);
}

.leaderboard-content tr:hover {
  background: rgba(255, 217, 59, 0.1);
}

.leaderboard-content tr:first-child td {
  color: gold;
  font-weight: bold;
}

.leaderboard-content tr:nth-child(2) td {
  color: silver;
}

.leaderboard-content tr:nth-child(3) td {
  color: #cd7f32;
}


  </style>
 
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

</head>
<body>
<div class="game-root" id="app">
<div class="scene" id="scene">
  <div class="bg" id="bg"></div>
</div>


  <div class="hud" id="hud">
     <button class="icon-btn" id="btnInvToggle" title="–î–∏–ø–ª–æ–º–∞—Ç">üíº</button>
    <button class="icon-btn" id="btnMenu" title="–ú–µ–Ω—é">‚ò∞</button>
    <button class="icon-btn" id="btnSound" title="–ó–≤—É–∫">üîä</button>
  </div>
  <div class="inventory" id="inv">
  <div class="inventory-header">
    <strong>–î–∏–ø–ª–æ–º–∞—Ç</strong>
    <span class="hint">noir collection</span>
    <span class="points" id="inventoryPoints">0 pts</span>
  </div>
  
  
  <div class="grid" id="invGrid"></div>
</div>

  <div class="dialog" id="dialog" style="display:none">
    <div class="portrait"><img id="portrait" alt="portrait"></div>
    <div class="bubble">
      <div class="typewriter" id="dialogText"></div>
      <div class="choices" id="choices"></div>
    </div>
  </div>
  <div class="ep-title" id="epTitle"><div class="ep-pill" id="epTitleText">–≠–ø–∏–∑–æ–¥ 1</div></div>
  <div class="main-menu" id="mainMenu">
    <div class="menu-card">
      <h1>The cat Matrix's Office Noir*</h1>
      <p>–æ—Ñ–∏—Å–Ω—ã–π –Ω—É–∞—Ä –∫–æ—Ç–∞ –ú–∞—Ç—Ä–∏–∫—Å–∞</p>
      <label>–ù–∏–∫–Ω–µ–π–º/–∫–ª–∏—á–∫–∞/–ø–æ–≥–æ–Ω—è–ª–æ</label>
      <input type="text" id="nickname" placeholder="from 3 to 12: [a-zA-Z0-9_]" maxlength="12" />
      <div class="hint" style="margin:6px 0 12px; color:#FFD700;">–î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è: –ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã/–Ω–∏–∂–Ω–µ–µ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ, 3‚Äì12 —Å–∏–º–≤–æ–ª–æ–≤.</div>
      <div class="menu-grid">
        <button class="btn" id="btnNew">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        <button class="btn" id="btnContinue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button class="btn" id="btnInventory">–î–∏–ø–ª–æ–º–∞—Ç</button>
        <button class="btn" id="btnLeaders">–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</button>
        <button class="btn" id="btnPersona">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</button>
        <button class="btn" id="btnAbout">–û–± –∞–≤—Ç–æ—Ä–µ</button>
      </div>
    </div>
  </div>
</div>
<script>


const firebaseConfig = {
  apiKey: "AIzaSyC...",  
  authDomain: "noir-game.firebaseapp.com",  
  databaseURL: "https://matrix-noir-default-rtdb.europe-west1.firebasedatabase.app/",  
  projectId: "noir-game",  
  storageBucket: "noir-game.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abcdef123456"
};


firebase.initializeApp(firebaseConfig);
const database = firebase.database();

console.log('üî• Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω!');


   

async function typeWriter(element, text, speed = 30) {
    element.textContent = '';
    for (let i = 0; i < text.length; i++) {
        element.textContent += text[i];
        await new Promise(resolve => setTimeout(resolve, speed));
    }
}


async function showDisclaimer() {
    const disclaimer = document.getElementById('disclaimer');
    const disclaimerText = document.getElementById('disclaimerText');
    const disclaimerBtn = document.getElementById('disclaimerBtn');
    
   
    disclaimer.style.display = 'flex';
    setTimeout(() => disclaimer.classList.add('show'), 50);
    
    
    await typeWriter(disclaimerText, DISCLAIMER_TEXT, 30);
    
    
   

disclaimerBtn.style.display = 'block';
disclaimerBtn.style.opacity = '1';
disclaimerBtn.style.transform = 'translateY(0)';
console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∞');
 
    
    disclaimerBtn.onclick = () => {
       
        state.disclaimerShown = true;
        save();
        
       
        disclaimer.classList.remove('show');
        setTimeout(() => {
            disclaimer.style.display = 'none';
            
           
            closeMenu();
        }, 500);
    };
}

const DIALOGS = {
  ep1: [
    {"speaker":"morpheus", "portrait": "assets/img/morpheus.png", "textColor":"#00FF41", "text":"Wake up, Neo. The Matrix has you"},
    {"speaker":"morpheus", "portrait": "assets/img/morpheus.png", "textColor":"#00FF41", "text":"Follow the white rabbit"},
    {"speaker":"matrix","text":"–ß—Ç–æ? —ç—Ç–æ —à—É—Ç–∫–∞?"},
    {"speaker":"matrix","text":"–Ø –∂–µ –ø—Ä–æ—Å—Ç–æ —à–µ–ª –≤ —á–µ—Å—Ç–Ω—ã–π –æ—Ñ–∏—Å..."},
    {"speaker":"matrix","text":"–£—Ç—Ä–æ–º —è —Å–æ–≤—Å–µ–º —Ä–∞–∑–±–∏—Ç—ã–π. –ü–æ–π–¥—É –ø–æ–∏—â—É –º–æ–ª–æ–∫–æ, —Ç–∞–∫–æ–µ –∂–µ —Å–≤–µ–∂–µ–µ, –∫–∞–∫ –Ω–∞—à –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å —Å–æ–≤–µ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤ –∫–∞–∂–¥—É—é –ø—è—Ç–Ω–∏—Ü—É"},
    {"speaker":"matrix","text":"–ê –º–æ–∂–µ—Ç –ª—É—á—à–µ –∫–æ—Ñ–µ? —Ñ–∏–ª—å—Ç—Ä? –¥–∞, —Ñ–∏–ª—å—Ç—Ä –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ –ª—É—á—à–µ! –ù–æ, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –µ—â—ë –Ω–µ –¥–æ–≥–æ–≤–æ—Ä–∏–ª—Å—è —Å –ê–•–û –∏ –°–∫—É—Ä–∞—Ç–æ–≤—ã–º –æ –ø–æ—Å—Ç–∞–≤–∫–µ –Ω–∞–º —Å–≤–µ–∂–µ—Å–≤–∞—Ä–µ–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞."},
    {"speaker":"matrix","text":"–ù—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–µ–±–µ –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫—É –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å!"},
    {"speaker":"matrix","text":"–ò–ª–∏ –º–æ–∂–µ—Ç –ª—É—á—à–µ —Å—Ä–∞–∑—É –∑–∞–¥–∞—á—É –≤ jira? –∞ miro –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç? –æ—Ö —É–∂ —ç—Ç–∏ —Å–∞–Ω–∫—Ü–∏–∏... –Ω–µ –¥–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–º –∫–æ—Ç–∞–º"},
    {"speaker":"matrix","text":"–û—Å–º–æ—Ç—Ä—é—Å—å —Ç—É—Ç –Ω–µ–º–Ω–æ–≥–æ –∏ –ø–æ–π–¥—É-–∫–∞ —è –≤ —Å—Ç–æ—Ä–æ–Ω—É –∫—É—Ö–Ω–∏ –Ω–∞ 4-–π —ç—Ç–∞–∂, –Ω–∞—à–∞ –∫–æ—Ñ–µ—Ç–∞—á–∫–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç :("},
    {"speaker":"matrix","text":"–ú–æ–∂–µ—Ç –∑–∞–≤—Ç—Ä–∞–∫–∞—é—â–µ–≥–æ –∑–∞–ø–µ–∫–∞–Ω–∫–æ–π –ë–æ—Ä–∏—Å–∞ –≤—Å—Ç—Ä–µ—á—É, –∞ –º–æ–∂–µ—Ç –∏ —Å –Ω–æ–≤–µ–Ω—å–∫–æ–π –∫–æ–ª–ª–µ–≥–æ–π –ø–æ–º—É—Ä–ª—ã–∫–∞—é.."}
  ],
 ep2: [
  /* 0 */ {"speaker":"matrix","text":"–æ, –õ—é–±–æ–≤—å, –∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –º—É—Ä!"},
  
  /* 1 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–ø—Ä–∏–≤–µ—Ç–∏–∫ :)"},
  
  /* 2 */ {"speaker":"matrix","text":"–º–æ–∂–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å? –∞ –µ—Å—Ç—å –ª–∏ —É –Ω–∞—Å –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –ø—Ä–æ—Ñ—Å–æ—é–∑?"},
  
  /* 3 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"—Ö–∞—Ö–∞, –∞ –∑–∞—á–µ–º —Ç–µ–±–µ –ø—Ä–æ—Ñ—Å–æ—é–∑, –ú–∞—Ç—Ä–∏–∫—Å? –ó–∞—Ö–æ–¥–∏, –ø–æ–≥–æ–≤–æ—Ä–∏–º!"},
  
  /* 4 */ {"speaker":"matrix","text":"–Ω—É –∫–∞–∫ –∑–∞—á–µ–º.. –æ—Ç—Å—Ç–∞–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∞ —Ç—Ä—É–¥—è—â–∏—Ö—Å—è... –≤–µ—Å—Ç–∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã —Å —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–º.."},
  
  /* 5 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–∞ —á—Ç–æ, —Ä–∞–∑–≤–µ —Å–µ–π—á–∞—Å —á—å–∏-—Ç–æ –ø—Ä–∞–≤–∞ –Ω–∞—Ä—É—à–∞—é—Ç—Å—è?"},
  
  /* 6 */ {"speaker":"matrix","text":"–¥–∞ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ, –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π.. –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è, –Ω—É –∏–ª–∏ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Ç—Ä—É–¥–æ–≤–∞—è —Å–∞–º–æ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, —Ç–∞–∫ —Å–∫–∞–∑–∞—Ç—å.."},
  
  /* 7 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–∞, –ø–æ–Ω—è–ª–∞! –í—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –∏–¥–µ–∏"},
  
  /* 8 */ {"speaker":"matrix","text":"–º—è—É! –¥–∞! –≠—Ç–æ –≤—Ä–æ–¥–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø—ã. –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–Ω–∞–µ—à—å, –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –ø–∞—Ä–∫ –ì–æ—Ä–∫–∞?"},
  
  /* 9 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ?"},
  
  /* 10 */ {"speaker":"matrix","text":"–Ω–µ—Ç, –ø–∞—Ä–∫ '–ì–æ—Ä–∫–∞'! –ï–≥–æ –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ —Å–∏–ª–∞–º–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø—ã –∂–∏—Ç–µ–ª–µ–π –Ω–∞ –º–µ—Å—Ç–µ —Å—Ç–∏—Ö–∏–π–Ω–æ–π –ø–∞—Ä–∫–æ–≤–∫–∏, –∞ —Ä–∞–Ω—å—à–µ —Ç–∞–º –±—ã–ª–∞ –±–æ–ª—å–Ω–∏—Ü–∞, –∞ –µ—â–µ —Ä–∞–Ω—å—à–µ —à–∫–æ–ª–∞... –ø—Ä–∏–≤–ª–µ–∫–ª–∏ –º–µ—Å—Ç–Ω—ã—Ö –¥–µ–ø—É—Ç–∞—Ç–æ–≤, –≤—ã–±–∏–ª–∏ –±—é–¥–∂–µ—Ç... –≤–æ—Ç, —è—Ä–∫–∏–π –ø—Ä–∏–º–µ—Ä –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–∞–º–æ—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"},
  
  /* 11 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–Ω–µ—Ç, –ú–∞—Ç—Ä–∏–∫—Å, —è –Ω–µ —Å–ª—ã—à–∞–ª–∞ –æ —Ç–∞–∫–æ–º –ø–∞—Ä–∫–µ! –ê –≥–¥–µ –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è?"},
  
  /* 12 */ {"speaker":"matrix","text":"–¥–∞ –ø—Ä—è–º–æ –Ω–∞–ø—Ä–æ—Ç–∏–≤ —Ö–æ—Ä–∞–ª—å–Ω–æ–π —Å–∏–Ω–∞–≥–æ–≥–∏! –ú–∏—Ö–∞–∏–ª –¢—É—Ä–µ—Ü–∫–∏–π –∏–º–µ–Ω–Ω–æ —Ç–∞–º –æ—Å–Ω–æ–≤–∞–ª —Å–≤–æ–π —Ö–æ—Ä!"},
  
  /* 13 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–æ–≥–æ.."},
  
  /* 14 */ {"speaker":"matrix","text":"–Ω—É –¥–∞, —Å–æ–±—Ä–∞–ª –º–∞–ª–µ–Ω—å–∫–∏—Ö –º–∞–ª—å—á–∏–∫–æ–≤, –Ω–∞—É—á–∏–ª –∏—Ö –ø–µ—Ç—å –∏ —Å —Ç–µ—Ö –ø–æ—Ä –≤–æ—Ç —É–∂–µ –±–æ–ª–µ–µ 30 –ª–µ—Ç –≤–æ–∑–∏—Ç –∏—Ö –ø–æ –º–∏—Ä—É, –ø–æ—á—Ç–∏ –∫–∞–∫ –ú–æ–∏—Å–µ–π!"},
  
  /* 15 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–≥–º"},
  
  /* 16 */ {"speaker":"matrix","text":"–∞ –º–æ–∂–Ω–æ –µ—â–µ –≤–æ–ø—Ä–æ—Å? –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥—Ä—É–∑–∏–Ω—Å–∫–∏–π –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤? –∫–æ–ª–ª–µ–≥–∏ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç—Å—è.. —è –∏—Ö, –≤ –æ–±—â–µ–º-—Ç–æ, –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é!"},
  
  /* 17 */ {"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–ø–æ–Ω–∏–º–∞–µ—à—å, –ú–∞—Ç—Ä–∏–∫—Å.. —É –Ω–∞—Å –±—é–¥–∂–µ—Ç –∑–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –≥–æ–¥–∞.. –Ω–æ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥ –º—ã —Ç–æ—á–Ω–æ –≤—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä—É–µ–º!"},

/* 19 */
{"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"..."},
{"speaker":"chef", "portrait":"assets/img/chief_1.png", "text":"–ú–∞—Ç—Ä–∏–∫—Å, –∫–æ–≥–¥–∞ –ø—Ä–µ–∑–∞ –≥–æ—Ç–æ–≤–∞ –±—É–¥–µ—Ç? –≥–¥–µ —Ä–∞—Å—Å—ã–ª–∫–∞ –ø–∏—Å–µ–º —Å—á–∞—Å—Ç—å—è –Ω–µ–≥–æ–¥—è—è–º? –ò–¥–∏, –∞ —è –ø–æ–∫–∞ —Å –õ—é–±–æ–π –ø–æ–≥–æ–≤–æ—Ä—é!"},  // ‚¨ÖÔ∏è –°—Ä–∞–∑—É –∫ –∫–æ–Ω—Ü—É
{"speaker":"matrix","text":"–¥–∞ —è –≤–æ–æ–±—â–µ –∑–∞ –∫–æ—Ñ–µ –ø—Ä–∏—à–µ–ª, –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º —ç—Ç–∞–∂–µ —Ç–∞—á–∫–∞ —Å–ª–æ–º–∞–ª–∞—Å—å!"},
{"speaker":"chef", "portrait":"assets/img/chief_1.png", "text":"–±–µ–∑–¥–µ–ª—å–Ω–∏–∫..."},
{"speaker":"matrix","text":"–õ–∞–¥–Ω–æ, –ø–æ–π–¥—É. –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è!"},
{"speaker":"matrix","text":"–ê –∫–∞–∫ –≤—ã–π—Ç–∏ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞? –∑–∞–º–æ–∫ —É –≤–∞—Å —Ç–∞–∫–æ–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π.. —Ä–µ—Ç—Ä–æ.."},
{"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–∞ –∑—Ä—è –≤—ã –¥–≤–µ—Ä—å –∑–∞—Ö–ª–æ–ø–Ω—É–ª–∏, —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Ü–∏—Ñ—Ä –≤–≤–µ—Å—Ç–∏!"},
{"speaker":"matrix","text":"–¥–∞? –∞ –∫–∞–∫–æ–π –ø–∞—Ä–æ–ª—å?"},
{"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–ú–∞—Ç—Ä–∏–∫—Å, —Ç—ã –≤–µ–¥—å —Å—Ç–æ–∏—à—å –≤ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å –±–∞–¥–¥–∏! –í –∑–∞–ø–∞—Å–µ, —Ç–∞–∫ —Å–∫–∞–∑–∞—Ç—å.."},
{"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–ê –≤—Å–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–∞ —Ä–æ–ª—å –±–∞–¥–¥–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω–∞ –∑–Ω–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π –∏ —Å–æ–∫—Ä–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª!"},
{"speaker":"lyuba", "portrait":"assets/img/lyuba_face2.png", "text":"–£ –Ω–∞—Å –≤–µ–¥—å <u>–ß</u>–µ—Å—Ç–Ω—ã–π <u>–ó</u>–Ω–∞–∫! –¢–∞–∫ —á—Ç–æ, —Ç–æ—á–Ω–æ –¥–æ–≥–∞–¥–∞–µ—à—å—Å—è. –¢–µ–º –±–æ–ª–µ–µ —Ç—ã —É –Ω–∞—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º —Ä–∞–±–æ—Ç–∞–µ—à—å!"},
{"type":"doorLock", "code":["0","4","3"]},


],



 ep3: [
  /* 0 */ {"speaker":"matrix","text":"–º—Ä—Ä.. —è –Ω–∞ –∫—É—Ö–Ω–µ! —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ, –Ω–æ —Å–µ–≥–æ–¥–Ω—è –º–Ω–æ–≥–æ–ª—é–¥–Ω–æ, —Ö–æ—Ç—å –∏ —É—Ç—Ä–æ –Ω–∞ –¥–≤–æ—Ä–µ!"},
  /* 1 */ {"speaker":"matrix","text":"–ù–∞–¥–æ –±—ã –±–∞—Ö–Ω—É—Ç—å –∫–æ—Ñ–µ–π–∫—É.. —Å –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –º–æ–ª–æ—á–∫–æ–º!"},
  {"type":"coffeeGame"},
  {"speaker":"matrix","text":"–ú–º–º, –∫–æ—Ñ–µ–µ–∫! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å!"},
  /* 2 */ {"speaker":"matrix","text":"—Ç–∞–∫–∏ –ë–æ—Ä—é –Ω–µ –≤–∏–¥–Ω–æ. –ù–µ –ø—Ä–∏–µ—Ö–∞–ª, –Ω–∞ –ø–æ–ª—è–Ω–∫–µ –æ—Å—Ç–∞–ª—Å—è.. –º–æ–≥—É –µ–≥–æ –ø–æ–Ω—è—Ç—å, –ø–æ–≥–æ–¥–∞ —Å–µ–π—á–∞—Å —Å–æ–≤—Å–µ–º –Ω–µ –æ—Ñ–∏—Å–Ω–∞—è.."},
  /* 3 */ {"speaker":"matrix","text":"–≤—Å–µ-—Ç–∞–∫–∏ —Å–∫–æ–ª—å–∫–æ –∑–¥–µ—Å—å —Ä–∞–∑–Ω—ã—Ö –±–∞–Ω–æ–∫ —Å–∫–ª—è–Ω–æ–∫.. –∫–∞–∫ —Ö–æ–∑—è—é—à–∫–∏ –∑–∞ –≤—Å–µ–º —É—Å–ø–µ–≤–∞—é—Ç, –Ω–µ –ø–æ–Ω–∏–º–∞—é.."},
  /* 4 */ {"speaker":"matrix","text":"–Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —É –Ω–∏—Ö –µ—â–µ –º–Ω–æ–≥–æ –≤–∞–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã, –∫–æ—Ç–æ—Ä—É—é –º—ã –Ω–µ –∑–∞–º–µ—á–∞–µ–º!"},
  /* 5 */ {"speaker":"matrix","text":"–≤–æ—Ç –º—É—Ö —Å—Ç–∞–ª–æ –º–µ–Ω—å—à–µ? –≤—Ä–æ–¥–µ –±—ã –º–µ–Ω—å—à–µ! –ë–æ–ª—å—à–∏–µ —Å—Ç–∞–∫–∞–Ω—á–∏–∫–∏ –æ—Ç–≤–æ–µ–≤–∞–ª–∏? –æ—Ç–≤–æ–µ–≤–∞–ª–∏! –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –º–æ–ª–æ–∫–æ —Ä–∞–∑—Ä–µ—à–∏–ª–∏? –Ω—É —Ç—É—Ç –¥–∞.. –ø–æ–∫–∞ –Ω–µ –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å"},
  
  /* 6 */ {
    "speaker":"matrix",
    "choices": [
      {"text":"–æ, –∫–µ—à—å—é!", "goto":7},
      {"text":"–°–∫–æ–ª—å–∫–æ –∑–¥–µ—Å—å —Ä–∞–∑–Ω—ã—Ö –∫—É–±–∫–æ–≤ –∏ –º–µ–¥–∞–ª–µ–π‚Ä¶.", "goto":11}
    ]
  },
  
  /* 7 - –í–ï–¢–ö–ê 1 */
  {"speaker":"matrix","text":"—É—Ö–æ–¥–∏–º, —É—Ö–æ–¥–∏–º, —É—Ö–æ–æ–æ–¥–∏–∏–º! (–≥–æ–ª–æ—Å–æ–º –ò–ª—å–∏ –õ–∞–≥—É—Ç–µ–Ω–∫–æ) —Ö–∞-—Ö–∞"},
  
  /* 8 */
  {"speaker":"matrix","text":"*–∏ —è–±–ª–æ–∫–æ –ø—Ä–∏—Ö–≤–∞—á—É, –ø–æ–µ–¥–µ—Ç –∫–æ –º–Ω–µ –¥–æ–º–æ–π*"},
  
  /* 9 */
  {
    "speaker":"matrix",
    "text":"—Ö–µ—Ö",
    "choices": [{"text":"[–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å]", "goto": 999}]
  },
  
  /* 10 - –ø—Ä–æ–ø—É—Å–∫ */
  null,
  
  /* 11 - –í–ï–¢–ö–ê 2 */
  {"speaker":"matrix","text":"—è —Å—á–∏—Ç–∞—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∑–¥–µ—Å—å –∏–º —Å–∞–º–æ–µ –º–µ—Å—Ç–æ. –õ—é–¥–∏ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å —Å–≤–æ–∏—Ö –≥–µ—Ä–æ–µ–≤!"},
  
  /* 12 */
  {
    "speaker":"matrix",
    "text":"—Ö–µ—Ö",
    "choices": [{"text":"[–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å]", "goto": 999}]
  }
],



 ep4: [
  /* 0 */ {"speaker":"matrix","text":"–ê —á—Ç–æ —ç—Ç–æ —É –≤–∞—Å? –ë—Ä–∞–∑–∏–ª—å—Å–∫–∞—è –≥–µ—Ä–∏–ª—å—è? –ë–∏–æ–≥—Ä–∞—Ñ–∏—è –†–æ–±–µ—Ä—Ç–∞ –û–ø–ø–µ–Ω–≥–µ–π–º–µ—Ä–∞?"},

  /* 1 */ {"speaker":"security","portrait":"assets/img/security_face.png","text":"—ç—Ç–æ –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–ª –∞—Ç–æ–º–Ω—É—é –±–æ–º–±—É –∏ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø—ã—Ç–∞–Ω–∏–π –Ω–∞ –ø–æ–ª–µ–≥–æ–Ω–µ –¢—Ä–∏–Ω–∏—Ç–∏ —Å–∫–∞–∑–∞–ª ¬´–Ø —Å—Ç–∞–ª —Å–º–µ—Ä—Ç—å—é, —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª–µ–º –º–∏—Ä–æ–≤¬ª?"},
  
  /* 2 */ {"speaker":"matrix","text":"–¥–∞, –Ω–æ –æ–Ω –≤–µ–¥—å —Å–æ–∑–¥–∞–ª –±–æ–º–±—É, —á—Ç–æ–±—ã –Ω–µ–º—Ü–µ–≤ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å...."},
  
  /* 3 */ {"speaker":"security","portrait":"assets/img/security_face.png","text":"–î–∞ –Ω–µ—Ç, –ú–∞—Ç—Ä–∏–∫—Å, —ç—Ç–æ –Ω–µ –ø—Ä–æ –Ω–µ–≥–æ. –ö—Ç–æ-—Ç–æ –æ—Å—Ç–∞–≤–∏–ª –≤ –æ—Ñ–∏—Å–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–æ–≤—É—é –∫–Ω–∏–≥—É –ø—Ä–æ –∂–∏–∑–Ω—å –∏ –≤–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –°—Ç—ç–Ω–∞ –õ–∏! –ù–∏–∑–∫–∏–π –ø–æ–∫–ª–æ–Ω —ç—Ç–æ–º—É —á–µ–ª–æ–≤–µ–∫—É"},
  
  /* 4 */ {"speaker":"matrix","text":"–û–≥–æ! —ç—Ç–æ –∫–æ—Ç–æ—Ä—ã–π –º—Å—Ç–∏—Ç–µ–ª–µ–π –ø—Ä–∏–¥—É–º–∞–ª?"},
  
  /* 5 */ {"speaker":"security","portrait":"assets/img/security_face.png","text":"–¥–∞! –û–±–æ–∂–∞—é –∂–µ–ª–µ–∑–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞!"},
  
  /* 6 */ {"speaker":"matrix","text":"–Ω—É –¥–∞, –æ–Ω –∂–µ –≥–µ–Ω–∏–π, –º–∏–ª–ª–∏–∞—Ä–¥–µ—Ä, –ø–ª—ç–π–±–æ–π, —Ñ–∏–ª–∞–Ω—Ç—Ä–æ–ø...."},
    
  /* 11 */ {"speaker":"matrix","text":"–í–æ–∑–≤—Ä–∞—â–∞—è—Å—å –∫ –†–æ–±–µ—Ä—Ç—É –û–ø–ø–µ–Ω–≥–µ–π–º–µ—Ä—É, –≤—ã –≤—Å–µ—Ç-—Ç–∞–∫–∏ —á–∏—Ç–∞–ª–∏?"},
  
  /* 12 */ {"speaker":"security","portrait":"assets/img/security_face.png","text":"–Ω–µ—Ç, –Ω–æ —è —Å–º–æ—Ç—Ä–µ–ª —Ñ–∏–ª—å–º!"},
  
  /* 13 */ {"speaker":"matrix","text":"–ø–æ–Ω—è–ª, –∞ —è —Ç–æ–ª—å–∫–æ '–±–∞—Ä–±–∏' —Å–º–æ—Ç—Ä–µ–ª..–≤–∞–º –Ω–µ –ø–æ–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —Ñ–∏–ª—å–º —Å–æ–≤—Å–µ–º –Ω–µ –ø—Ä–æ..."},
  
  /* 14 */ {"speaker":"matrix","text":"–ª–∞–¥–Ω–æ, —É –Ω–∞—Å –µ—â–µ —ç—Ç–∏ —Å–∞–º—ã–µ –±–∞—Ä–±–∏ –Ω–µ –æ—Ç–º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω—ã, –∫–∞–∂–µ—Ç—Å—è..—ç—Ç–æ –Ω—É–∂–Ω–æ —É –í–∞—Ä–≤–∞—Ä—ã —É—Ç–æ—á–Ω–∏—Ç—å! –ø–æ–π–¥—É —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ –Ω–µ –Ω–∞ –¥–µ–º–∞–≥–æ–≥–∏—é"},
  
  /* 15 */ {"speaker":"chief","portrait":"assets/img/chief_1.png","text":"–ú–∞—Ç—Ä–∏–∫—Å, —Ç—ã –µ—â–µ –∑–¥–µ—Å—å?"},
  
  /* 16 */ {"speaker":"matrix","text":"–¢–∞–∫ —è –≤–µ–¥—å –∫–æ—Ñ–µ –≤—ã–ø–∏—Ç—å –ø—Ä–∏—à–µ–ª, —Å–µ–π—á–∞—Å –∫–æ—Ñ–µ–∏–Ω –ø–æ–≤—ã—Å–∏—Ç —Ä–µ—Ñ–ª–µ–∫—Ç–æ—Ä–Ω—É—é –≤–æ–∑–±—É–¥–∏–º–æ—Å—Ç—å —Å–ø–∏–Ω–Ω–æ–≥–æ –º–æ–∑–≥–∞, —Å–æ–∫—Ä–∞—Ç–∏—Ç –º–∏–æ–∫–∞—Ä–¥—É, —è —Å—Ä–∞–∑—É –≤ –ø–æ–ª—Ç–æ—Ä–∞ —Ä–∞–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ —Å—Ç–∞–Ω—É!"},
  
  /* 17 */ {"speaker":"security","portrait":"assets/img/security_face.png","text":"0_0...."},
  
  /* 18 */ {"speaker":"chief","portrait":"assets/img/chief_1.png","text":"–¥–∞–≤–∞–π –¥–∞–≤–∞–π, —è —â–∞—Å –¥–æ–≥–æ–Ω—é, –ø–æ–¥–∫–∏–Ω—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –∑–∞–¥–∞—á–∫—É"},
  
  /* 19 */ {"speaker":"security","portrait":"assets/img/security_face.png","text":"—Ö–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è, –ú–∞—Ç—Ä–∏–∫—Å!"}
],

 ep5: [
  /* 0 */ {"speaker":"matrix","text":"*–æ–ø—è—Ç—å? –¥–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å.... –∫–æ–ª–ª–µ–≥–∏ –º–Ω–µ —Ç–æ—á–Ω–æ –Ω–µ –ø–æ–≤–µ—Ä—è—Ç*"},
  
  /* 1 */ {"speaker":"matrix","text":"–≥–∫—Ö–º.. –¥–æ–±—Ä—ã–π –¥–µ–Ω—å, –§–∏–ª–∏–ø–ø –ë–µ–¥—Ä–æ—Å–æ–≤–∏—á!"},
  
  /* 2 */ {"speaker":"bodyguard","portrait":"assets/img/king_filipp_bg.png","text":"*—É–≥—Ä—é–º—ã–π –≤–∑–≥–ª—è–¥*"},
  
  /* 3 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ú–∞—Ç—Ä–∏–∫—Å! ;)"},
  
  /* 4 */ {"speaker":"matrix","text":"–∞ –≤—ã —á—Ç–æ —Ç—É—Ç –¥–µ–ª–∞–µ—Ç–µ?"},
  
  /* 5 */ {"speaker":"bodyguard","portrait":"assets/img/king_filipp_bg.png","text":"–∫—Ö–µ-–∫—Ö–µ... -_-"},
  
  /* 6 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"–¥–∞ —è, –ú–∞—Ç—Ä–∏–∫—Å, –Ω–µ –≤ —Ç–æ—Ç –ª–∏—Ñ—Ç –∑–∞—à–µ–ª!"},
  
  /* 7 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"—è –≤–æ–æ–±—â–µ –∫ –Ø–Ω–µ –ø—Ä–∏–µ—Ö–∞–ª"},
  
  /* 8 */ {"speaker":"matrix","text":"–Ω—É —è —Ç–∞–∫ –∏ –ø–æ–¥—É–º–∞–ª. –≠—Ç–æ –≤–∞–º –ª—É—á—à–µ –±—ã–ª–æ —Å —É–ª–∏—Ü—ã –∑–∞–π—Ç–∏.."},
  
  /* 9 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"–¥–∞ —è —É–∂–µ –ø–æ–Ω—è–ª.. —Å–Ω–∞—á–∞–ª–∞ –∂–¥–∞–ª —ç—Ç–æ—Ç –ª–∏—Ñ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç, –ø–æ—Ç–æ–º –æ–Ω –µ—â–µ –∏ –ø—Ä–æ–µ—Ö–∞–ª –º–∏–º–æ –º–æ–µ–≥–æ —ç—Ç–∞–∂–∞... –∫–æ—à–º–∞—Ä .."},
  
  /* 10 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"–≤–æ—Ç –ø–æ–ø–∞–ª–∏ —Å –õ–µ–æ–Ω–∏–¥–æ–º –≤ —á–µ—Å—Ç–Ω—ã–π –∑–Ω–∞–∫ –∫–∞–∫–æ–π-—Ç–æ"},
  
  /* 11 */ {"speaker":"matrix","text":";)"},
  
  /* 12 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"–õ—ë–Ω—è, —Ç—ã —Å–ª—ã—à–∞–ª —á—Ç–æ-–Ω–∏–±—É–¥—å –ø—Ä–æ —ç—Ç–æ—Ç —á–µ—Å—Ç–Ω—ã–π –∑–Ω–∞–∫?"},
  
  /* 13 */ {"speaker":"bodyguard","portrait":"assets/img/king_filipp_bg.png","text":"–Ω—É, –≥—Ö–º, –ø–æ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—É –≤–∏–¥–µ–ª —Ä–µ–∫–ª–∞–º—É.. –º–æ–ª–æ—á–∫—É —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω, —É –º–µ–Ω—è –∂–µ–Ω–∞ –ø–æ–ª—å–∑—É–µ—Ç—Å—è!"},
  
  /* 14 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"–æ, –∫–∞–∫ –∑–¥–æ—Ä–æ–≤–æ –ø—Ä–∏–¥—É–º–∞–ª–∏ –¥–ª—è –Ω–∞—Ä–æ–¥–∞"},
  
  /* 15 */ {"speaker":"matrix","text":"–¥–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –≤ –æ–±—â–µ–º-—Ç–æ. –£–¥–æ–±–Ω–æ —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –Ω–∞ —ç—Ç–∏–∫–µ—Ç–∫–µ —Å –ª—É–ø–æ–π –∏—Å–∫–∞—Ç—å"},
  
  /* 16 */ {"speaker":"matrix","text":"–Ω—É –ª–∞–¥–Ω–æ, –º–Ω–µ –ø–æ—Ä–∞ –±–µ–∂–∞—Ç—å, –º—è—É!"},
  
  /* 17 */ {"speaker":"kirkorov","portrait":"assets/img/king_filipp_face.png","text":"—á–∞–æ-–∫–∞–∫–∞–æ, –ú–∞—Ç—Ä–∏–∫—Å!"},
  
  /* 18 */ {"speaker":"matrix","text":"–∞–≥–∞, –Ø–Ω–µ - –ø—Ä–∏–≤–µ—Ç! –î–∞ –∏ –ê–ª–ª–µ, –µ—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ—Å—å!"}
],

  ep6: [
  /* 0 */ {"speaker":"matrix","text":"–æ–ø–∞! –∫–∞–∫–∏–µ –ª—é–¥–∏ –≤ –Ω–∞—à–µ–º –æ–ø–µ–Ω—Å–ø–µ–π—Å–µ!"},
  
  /* 1 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–æ, –ú–∞—Ç—Ä–∏–∫—Å! —è —Ç–æ–∂–µ —Ä–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!"},
  
  /* 2 */ {"speaker":"matrix","text":"–í–∏–ª–ª–∏, –∞ —Ç—ã —á–µ–≥–æ —ç—Ç–æ –≤ –æ—Ñ–∏—Å–µ? –°–æ—Å–∫—É—á–∏–ª—Å—è?"},
  
  /* 3 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"—è —Å–µ–≥–æ–¥–Ω—è –±—É–¥—É –Ω–æ–≤—ã–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–±—ã—Ç–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å! –û–Ω –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –∫ —Å–ø—É—Ç–Ω–∏–∫–∞–º Starlink –ò–ª–æ–Ω–∞ –ú–∞—Å–∫–∞! –°–ª—ã—à–∞–ª –ø—Ä–æ —Ç–∞–∫–∏–µ?"},
  
  /* 4 */ {"speaker":"matrix","text":"–∫–æ–Ω–µ—á–Ω–æ! –ê —Ç—ã, –∫—Å—Ç–∞—Ç–∏, –∑–Ω–∞–µ—à—å —á—Ç–æ –∑–Ω–∞—á–∏—Ç –µ–≥–æ —Ñ–∞–º–∏–ª–∏—è? —ç—Ç–æ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ!"},
  
  /* 5 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"—Ö–º–º.. —á—Ç–æ?"},
  
  /* 6 */ {"speaker":"tikhonova","portrait":"assets/img/tikhonova_face.png","text":"–º—É—Å–∫—É—Å!"},
  
  /* 7 */ {"speaker":"matrix","text":"–¥–∞! –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞, –∞ —Ç—ã –æ—Ç–∫—É–¥–∞ –∑–Ω–∞–µ—à—å?"},
  
  /* 8 */ {"speaker":"tikhonova","portrait":"assets/img/tikhonova_face.png","text":"—É –º–µ–Ω—è –ø–æ–¥—Ä—É–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ –ø—Ä–µ–ø–æ–¥–∞–µ—Ç!"},
  
  /* 9 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–∞ —è –≤–æ–æ–±—â–µ IELTS —Å–¥–∞–ª —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞!"},
  
  /* 10 */ {"speaker":"matrix","text":"*madre mia*"},
  
  /* 11 */ {"speaker":"matrix","text":"–∫–ª–∞—Å—Å, –∞ —è —Å–∫–æ—Ç–Ω—ã–π –¥–≤–æ—Ä –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ —á–∏—Ç–∞–ª. –¢—è–∂–µ–ª–æ–≤–∞—Ç–æ –±—ã–ª–æ, —Ç–∞–º –º–Ω–æ–≥–æ —Å–ª–æ–≤ –Ω–µ —Å–∞–º—ã—Ö —á–∞—Å—Ç–æ —É–ø–æ—Ç—Ä–µ–±–ª—è–µ–º—ã—Ö –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–µ—á–∏"},
  
  /* 12 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–ú–∞—Ç—Ä–∏–∫—Å, —è –Ω–µ –ø–æ–Ω—è–ª, —Ç—ã —á–µ–≥–æ, —É–∂–µ –≤–µ—Å—å <u>BABOK</u> –≤—ã–∑—É–±—Ä–∏–ª?"},
  
  /* 13 */ {"speaker":"matrix","text":"–±–∞–±–æ–∫?"},
  
  /* 14 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"Business Analysis Body of Knowledge, –Ω–µ —Å–ª—ã—à–∞–ª –æ —Ç–∞–∫–æ–º?"},
  
  /* 15 */ {"speaker":"matrix","text":"...."},
  
  /* 16 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"—ç—Ç–æ –∂–µ –Ω–∞—Å—Ç–æ–ª—å–Ω–∞—è –∫–Ω–∏–≥–∞ –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞!"},
  
  /* 17 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–£ –°—Ç–∞–ª–∏–Ω–∞ –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–π –∫–Ω–∏–≥–æ–π –±—ã–ª —Ç—Ä—É–¥ –∏—Ç–∞–ª—å—è–Ω—Å–∫–æ–≥–æ –º—ã—Å–ª–∏—Ç–µ–ª—è —ç–ø–æ—Ö–∏ –≤–æ–∑—Ä–∞–∂–¥–µ–Ω–∏—è, –æ–Ω–∞ –∂–µ –†–µ–Ω–µ—Å—Å–∞–Ω—Å, –ù–∏–∫–∫–æ–ª–ª–æ –ú–∞–∫–∏–∞–≤–µ–ª–ª–∏ '–ì–æ—Å—É–¥–∞—Ä—å'"},
  
  /* 18 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–∞ —É —Ç–µ–±—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å BABOK!"},
  
  /* 19 */ {"speaker":"tikhonova","portrait":"assets/img/tikhonova_face.png","text":"........."},
  
  /* 20 */ {"speaker":"matrix","text":"–Ω—É —Ç–∞–∫ –∏ —á–µ–≥–æ —Å —Ç–≤–æ–∏–º–∏ –†–í? –ø—Ä–æ—Å—Ä–æ—á–∫—É —Ç–æ —Ö–æ—Ç—å –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–≤–æ–¥–∏—Ç—å –∏–∑ –æ–±–æ—Ä–æ—Ç–∞?"},
  
  /* 21 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –Ω–µ —Å–æ–≤—Å–µ–º —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω—ã, –Ω—É–∂–Ω—ã –ø–æ–ª–µ–≤—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è"},
  
  /* 22 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–≤–æ—Ç –º—ã, –∫—Å—Ç–∞—Ç–∏, —Å –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–π –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–æ–π —Å–∫–æ—Ä–æ –∫–∞–∫ —Ä–∞–∑ –ø–æ–µ–¥–µ–º –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è, –†–í —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, –∞–ø—Ç–µ–∫–∏ –∏ –º–µ–¥. –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –æ–±—É—á–∞—Ç—å!"},
  
  /* 23 */ {"speaker":"tikhonova","portrait":"assets/img/tikhonova_face.png","text":"–ú–∞—Ç—Ä–∫–∏—Å, —ç—Ç–æ –ø—Ä–∞–≤–¥–∞! –Ø —Å–µ–±–µ —É–∂–µ –º–æ–¥–Ω—ã–π –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç –∑–∞–∫–∞–∑–∞–ª–∞!"},
  
  /* 24 */ {"speaker":"matrix","text":"–∞ —è –¥—É–º–∞–ª –Ω–∞ –≤—Ä–µ–º—è –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –≤—ã–¥–∞—é—Ç..."},
  
  /* 25 */ {"speaker":"chief","portrait":"assets/img/chief_1.png","text":"–∞–≥–∞, –∏ —Ç–µ–ª–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—è —Å –≤–æ–¥–∏—Ç–µ–ª–µ–º! –î–∞–≤–∞–π—Ç–µ, —Ä–∞–±–æ—Ç–∞–π—Ç–µ!"},
  
  /* 26 */ {"speaker":"matrix","text":"*–¥–∞ —è –≤–µ–¥—å <u>–ö–û–¢</u>, —É –º–µ–Ω—è –≤–µ–¥—å <u>–õ–ê–ü–ö–ò</u>*"},
  
  /* 27 */ {"speaker":"matrix","text":"*–µ—â–µ –∏ –º—É–∑—ã–∫–∞ —ç—Ç–∞ –≤ –ø–ª—è—Å —Ç—è–Ω–µ—Ç*"},
  
  /* 28 */ {"speaker":"matrix","text":"*–ø–æ–π–¥—É-–∫–∞ —è –∫ —Å–µ–±–µ, –ø–æ–∫–∞ –º–æ–µ–≥–æ —Å–∞–º—É—Ä–∞—è –Ω–µ —É–≥–Ω–∞–ª–∏*"}
],

  ep7: [
  /* 0 */ {"speaker":"matrix","text":"—ç–º–º.. The Weeknd??"},
  
  /* 1 */ {"speaker":"tamerlan","portrait":"assets/img/weeknd_face.png","text":"–ü—Ä–∏–≤–µ—Ç, –Ω–µ, —è –¢–∞–º–µ—Ä–ª–∞–Ω!"},
  
  /* 2 */ {"speaker":"matrix","text":"—Ö–∞-—Ö–∞, –∏–∑–≤–∏–Ω–∏, –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏!!"},
  
  /* 3 */ {"speaker":"tamerlan","portrait":"assets/img/weeknd_face.png","text":"—Ö–∞—Ö–∞—Ö—Ö"},
    
  /* 5 */ {"speaker":"kosarev","portrait":"assets/img/kosarev.png","text":"–ø—Ä–∏–≤–µ—Ç, –∫–æ–ª–ª–µ–≥–∏! –ê —á—Ç–æ —è –∑–¥–µ—Å—å –¥–µ–ª–∞—é?"},
  
  /* 6 */ {"speaker":"kosarev","portrait":"assets/img/kosarev.png","text":"—è –≤–µ–¥—å –Ω–µ —Ö–æ—Ç–µ–ª –∑–¥–µ—Å—å –±—ã—Ç—å"},
  
  /* 7 */ {"speaker":"matrix","text":"–ê–ª–µ–∫—Å–µ–π –ê–Ω–∞—Ç–æ–ª–∏—á, —è –≤–µ–¥—å –æ–±–µ—â–∞–ª —Ç–µ–±–µ –∫–∞–º–µ–æ."},
    
  /* 9 */ {"speaker":"kosarev","portrait":"assets/img/kosarev.png","text":"–∞ —è –ø–æ—Ç–æ–º –ø–µ—Ä–µ–¥—É–º–∞–ª! –∏ –≤–æ–æ–æ–±—â–µ —è –Ω–µ –≤ —Ñ–∞—Ä–º–µ –¥–∞–∂–µ.."},
    
  /* 11 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –∫–æ–ª–ª–µ–≥–∏!"},
  
  /* 12 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–ø–æ–∫–∞ —à–µ–ª –ø–æ –æ–ø–µ–Ω—Å–ø–µ–π—Å—É, —Å–ª—ã—à–∞–ª —á—Ç–æ-—Ç–æ –ø—Ä–æ –≤–∏–∫–µ–Ω–¥–∞ –≥–æ–≤–æ—Ä–∏–ª–∏. –ê –º–Ω–µ –≤–æ—Ç –≥—Ä—É–ø–ø–∞ O-Zone –Ω—Ä–∞–≤–∏—Ç—Å—è!"},

 /* 13 */  {"speaker":"matrix","text":"*Ma-ia-hii, ma-ia-huu Ma-ia-hoo, ma-ia-haa*"},
  
  /* 14 */ {"speaker":"matrix","text":"–æ, –ë–æ—Ä–∏—Å, –∞ —è –¥—É–º–∞–ª —Ç—ã –Ω–µ –ø—Ä–∏–¥–µ—à—å —Å–µ–≥–æ–¥–Ω—è –≤ –æ—Ñ–∏—Å.."},
  
  /* 15 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"—Ç–∞–∫ —è –≤–µ–¥—å –≤ –°–∏—Ç–∏ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É —Å –ú–∏–Ω–ø—Ä–æ–º—Ç–æ—Ä–≥–æ–º –µ–∑–¥–∏–ª"},
  
  /* 16 */ {"speaker":"matrix","text":"—Å—É–±—Å—Ç–∞–Ω—Ü–∏—é –æ–±—Å—É–∂–¥–∞–ª–∏?"},
  
  /* 17 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–î–∞, –µ—ë —Å–∞–º—É—é! –¢–æ–ª—å–∫–æ –Ω–µ –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º —Å –î–µ–º–∏ –ú—É—Ä, –∞ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–µ–π—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–≥–æ –ª–µ—á–µ–±–Ω—ã–π, –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∏–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç"},

            {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":" –≠—Ç–æ –≤–µ—â–µ—Å—Ç–≤–æ (—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ, —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–ª–∏ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Å—ã—Ä—å–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –≥–æ—Ç–æ–≤—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º (—Ç–∞–±–ª–µ—Ç–æ–∫, —Ä–∞—Å—Ç–≤–æ—Ä–æ–≤, –º–∞–∑–µ–π)..."},
  
            {"speaker":"matrix","text":"–¥–∞ —Ç—ã —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª, –ë–æ—Ä–∏—Å –ú–∏—Ö–∞–ª—ã—á...."},

 /* 18 */ {"speaker":"matrix","text":"–Ω—É –ø–æ–Ω—è—Ç–Ω–æ, –¥–æ–ª–≥–æ –∂–µ –≤—ã —Å–∏–¥–µ–ª–∏ —Ç–∞–º!"},
  
  /* 19 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–ú–∞—Ç—Ä–∏–∫—Å, —Ç—ã –Ω–µ –ø–æ–≤–µ—Ä–∏—à—å, –∫–æ –º–Ω–µ –≤–µ–¥—å –Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–µ –º–µ—Å—Ç–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ-—Ü—ã–≥–∞–Ω–∫–∏ –ø—Ä–∏—Å—Ç–∞–≤–∞–ª–∏! –ò—Ö —É —Å–∏—Ç–∏ –±–æ–ª—å—à–µ, —á–µ–º –≥–æ–ª—É–±–µ–π –Ω–∞ –ø–ª–æ—â–∞–¥–∏ –°–∞–Ω-–ú–∞—Ä–∫–æ –≤ –í–µ–Ω–µ—Ü–∏–∏!"},
  
  /* 20 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–ø–æ–∑–æ–ª–æ—Ç–∏ –¥–∞ –ø–æ–∑–æ–ª–æ—Ç–∏ –Ω–∞–º —Ä—É—á–∫—É, –ø–µ—Ä–µ–≤–µ–¥–∏ –±–∏—Ç–æ–∫ –Ω–∞ –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª–µ–∫, —É –º–µ–Ω—è –∏ –∫—É–∫—É—Ö–∞-–∫–æ–¥ –∏–º–µ–µ—Ç—Å—è –Ω–∞ –±—É–º–∞–∂–∫–µ, –≥–æ–≤–æ—Ä–∏—Ç!"},
  
  /* 22 */ {"speaker":"matrix","text":"–Ω—É –∞ —Ç—ã —á–µ–≥–æ? –ø–µ—Ä–µ–≤–µ–ª?"},
  
  /* 23 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–¥–∞ —è –µ–ª–µ –æ—Ç–æ—Ä–≤–∞–ª—Å—è –æ—Ç –Ω–∏—Ö.. –û–Ω–∏ –Ω–∞ –ö—Ä–∏—Å –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å! –ò –≤–æ–æ–±—â–µ —è –≤—Å–µ –≤ –¥–æ–≥–∫–æ–∏–Ω–∞—Ö —Ö—Ä–∞–Ω—é! –±–∏—Ç–∫–æ–∏–Ω—ã —á—å–∏? –°–∞—Ç–æ—à–∏ –∫–∞–∫–æ–π-—Ç–æ, —á–µ—Ä—Ç –µ–≥–æ –∑–Ω–∞–µ—Ç.. –∞ –¥–æ–≥–∫–æ–∏–Ω –ò–ª–æ–Ω –ú–∞—Å–∫ –ø—Ä–∏–¥—É–º–∞–ª, –æ–Ω —Ç–æ –Ω–µ –∫–∏–Ω–µ—Ç, —É –Ω–µ–≥–æ —Ä–µ–ø—É—Ç–∞—Ü–∏—è!"},
  
  /* 24 */ {"speaker":"kris","portrait":"assets/img/Kris.png","text":"–æ—Ö—Ö, –≤—Å–µ–º –ø—Ä–∏–≤–µ—Ç...."},
  
  /* 25 */ {"speaker":"matrix","text":"–ö—Ä–∏—Å, —Ç—ã –∫–∞–∫ –æ—Ç —Ü—ã–≥–∞–Ω–æ–∫ –æ—Ç–≤—è–∑–∞–ª–∞—Å—å?"},
  
  /* 26 */ {"speaker":"kris","portrait":"assets/img/Kris.png","text":"–Ω—É —É –º–µ–Ω—è –±–∏—Ç–∫–æ–∏–Ω–æ–≤ —ç—Ç–∏—Ö –Ω–µ –±—ã–ª–æ, –Ω–∞—à–ª–∞ –≤ —Å—É–º–∫–µ —à–æ–∫–æ–ª–∞–¥–Ω—É—é –º–µ–¥–∞–ª—å–∫—É, —Å –¥–µ—Ç—Å–∫–æ–≥–æ —É—Ç—Ä–µ–Ω–Ω–∏–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å.."},
  
  /* 27 */ {"speaker":"kris","portrait":"assets/img/Kris.png","text":"–Ω—É —è –∏ –æ—Ç–¥–∞–ª–∞ –∏–º, —Å–∫–∞–∑–∞–ª–∞, —á—Ç–æ —ç—Ç–æ TON –ü–∞–≤–ª–∞ –î—É—Ä–æ–≤–∞. –ï–≥–æ —Ç–æ –≤—Å–µ –∑–Ω–∞—é—Ç, –≤–æ—Ç –∏ –ø–æ–≤–µ—Ä–∏–ª–∏!"},
  
  /* 28 */ {"speaker":"matrix","text":"<u>FREE DUROV</u>"},
  
  /* 30 */ {"speaker":"kosarev","portrait":"assets/img/kosarev.png","text":"–∫–æ–ª–ª–µ–≥–∏, –¥–∞–≤–∞–π—Ç–µ –±–µ–∑ –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–π"},
  
  /* 31 */ {"speaker":"kosarev","portrait":"assets/img/kosarev.png","text":"–∏–¥–∏—Ç–µ –≤ –∫—É—Ä–∏–ª–∫—É —Å–∞–±–æ—Ç–∏—Ä–æ–≤–∞—Ç—å!"}
],

  ep8: [
  /* 0 */ {"speaker":"matrix","text":"–ø–æ–∫–∞–∑–∞–ª–æ—Å—å?"},
  
  /* 1 */ {"speaker":"matrix","text":"—Ä–µ–±—è—Ç–∞, –≤—ã –≤–∏–¥–µ–ª–∏?"},
  
  /* 2 */ {"speaker":"kris","portrait":"assets/img/Kris.png","text":"..........?"},
  
  /* 3 */ {"speaker":"matrix","text":"–ë–µ–≥–µ–º–æ—Ç? —Ç—ã —á–µ–≥–æ —Ç—É—Ç –¥–µ–ª–∞–µ—à—å?"},
  
  /* 4 */ {"speaker":"begemot","portrait":"assets/img/cat_begemot_face.png","text":"–ü—Ä–†–∏–≤–µ—Ç, –¥–∞ –º—ã —Ç—É—Ç.. —ç—Ç–æ.. –º–∏–º–æ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏...–º—É–†–†"},
  
  /* 5 */ {"speaker":"matrix","text":"—á—Ç–æ-—Ç–æ —è —Ç–µ–±–µ –Ω–µ –≤–µ—Ä—é"},
  
  /* 6 */ {"speaker":"begemot","portrait":"assets/img/cat_begemot_face.png","text":"–ª–∞–¥–Ω–æ, —Ä–∞—Å–∫—É—Å–∏–ª! –£ –Ω–∞—Å —Å–µ–≥–æ–¥–Ω—è –≤–µ—á–µ—Ä–æ–º —à–æ—É –≤ —Ç–µ–∞—Ç—Ä–µ –°–∞—Ç–∏—Ä—ã!"},
  
  /* 7 */ {"speaker":"kris","portrait":"assets/img/Kris.png","text":"–æ, –∫–æ–ª–ª–µ–≥–∏, –∞ –º—ã –≤–µ–¥—å –¥–∞–≤–Ω–æ —Å–æ–±–∏—Ä–∞–ª–∏—Å—å –∫—É–¥–∞-–Ω–∏–±—É–¥—å –≤—ã–±—Ä–∞—Ç—å—Å—è –Ω–∞ —Ç–∏–º–±–∏–ª–¥–∏–Ω–≥, —Ç–∞–∫ —Å–∫–∞–∑–∞—Ç—å"},
  
  /* 8 */ {"speaker":"sasha","portrait":"assets/img/tikhonova_face.png","text":"–¥–∞–≤–∞–π—Ç–µ, —è –ó–ê!"},
  
  /* 9 */ {"speaker":"matrix","text":"–∫–æ–ª–ª–µ..."},
  
  /* 10 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–∏ –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —ç—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!"},
  
  /* 11 */ {"speaker":"matrix","text":"–Ω–æ.."},
  
  /* 12 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"–∞ —á—Ç–æ –±—É–¥–µ—Ç-—Ç–æ —Ç–∞–º, –Ω–∞ —ç—Ç–æ–º –≤–∞—à–µ–º —à–æ—É? —à–∞—Ö–º–∞—Ç–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä? —Ç–∞–∫ —è —Ç–∞–º –≤—Å–µ—Ö –ø–µ—Ä–µ–∏–≥—Ä–∞—é, —è –≤–µ–¥—å —á–µ–º–ø–∏–æ–Ω –¶–†–ü–¢!"},
  
  /* 13 */ {"speaker":"begemot","portrait":"assets/img/cat_begemot_face.png","text":"–ë—É–¥–µ—Ç —à–æ—É –¥–ª—è –º–æ—Å–∫–æ–≤—Å–∫–æ–π –ø—É–±–ª–∏–∫–∏! –°–µ–∞–Ω—Å —á–µ—Ä–Ω–æ–π –º–∞–≥–∏–∏ –∏ –ø–µ—Ä–µ–æ–¥–µ–≤–∞–Ω–∏—è –≤ —Å–∞–ª–æ–Ω–µ –ø–∞—Ä–∏–∂—Å–∫–∏—Ö –º–æ–¥!"},
  
  /* 14 */ {"speaker":"willi","portrait":"assets/img/willi_face.png","text":"—á–µ—Ä–Ω–∞—è –º–∞–≥–∏—è.. –∑–≤—É—á–∏—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ!"},
  
  /* 15 */ {"speaker":"kushch","portrait":"assets/img/Kushch_face.png","text":"–∞ –ø–µ—Ä–µ–æ–¥–µ–≤–∞—Ç—å—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ? <u>–º–µ–Ω—è –∏ –º–æ–π –º–æ–ª–¥–∞–≤—Å–∫–∏–π –∫–æ—Å—Ç—é–º—á–∏–∫ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç</u>..."},
  
  /* 16 */ {"speaker":"matrix","text":"*–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –º–Ω–µ –≤—Å–µ —ç—Ç–æ, –Ω–µ –∫ –¥–æ–±—Ä—É..*"},
  
  /* 17 */ {"speaker":"begemot","portrait":"assets/img/cat_begemot_face.png","text":"–Ω—É, –∑–Ω–∞—á–∏—Ç—Å –µ—â–µ —É–≤–∏–¥–∏–º—Å—è, –ú–Ø–£!"}
],

};
const EPISODE_BACKGROUNDS = {
  ep1: 'assets/img/hall_back3.png',
  ep2: 'assets/img/lyuba_pic3.png',
  ep3: 'assets/img/kitchen.png',
  ep4: 'assets/img/security.png',
  ep5: 'assets/img/king_filipp.png',
  ep6: 'assets/img/willi_back2.png',
  ep7: 'assets/img/os_back.png',
  ep8: 'assets/img/smoking.png'
};

const EPISODE_MUSIC = {
  ep1: 'assets/audio/music_ep1.mp3',
  ep2: 'assets/audio/music_ep2.mp3',
  ep3: 'assets/audio/music_ep3.mp3',
  ep4: 'assets/audio/music_ep4.mp3',
  ep5: 'assets/audio/music_ep5.mp3',
  ep6: 'assets/audio/music_ep6.mp3',
  ep7: 'assets/audio/music_ep7.mp3',
  ep8: 'assets/audio/music_ep8.mp3'
};

const CONFIG = {
  scoring: { common: 2, rare: 5, epic: 10, legendary: 50 },
  inventory: { cols: 5, rows: 4 },
  persona: {
    selected: localStorage.getItem('persona') || 'classic',
    options: {
      classic: { name:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', portrait:'assets/img/portraits/matrix_classic.png', sfx:'assets/audio/perfect.mp3', desc:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ú–∞—Ç—Ä–∏–∫—Å, –æ–Ω –∏ –≤ –∞—Ñ—Ä–∏–∫–µ –ú–∞—Ç—Ä–∏–∫—Å.' },
      vampire: { name:'–í–∞–º–ø–∏—Ä', portrait:'assets/img/portraits/matrix_vampire.png', sfx:'assets/audio/sfx_persona_vampire.mp3', desc:'–ë–µ–ª–ª–∞, —ç—Ç–æ –∫–æ–∂–∞ —É–±–∏–π—Ü—ã' },
      lovelas: { name:'–õ–∞–≤–∏–ª–∞—Å', portrait:'assets/img/portraits/matrix_lovelas.png', sfx:'assets/audio/sfx_persona_lovelas.mp3', desc:'–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –º–µ–Ω—è, —Ç–µ–ø–µ—Ä—å –Ω–∞ —Å–≤–æ–µ–≥–æ –∫–æ—Ç–∞, —Å–Ω–æ–≤–∞ –Ω–∞ –º–µ–Ω—è. –î–∞, —è –Ω–∞ –∫–æ–Ω–µ!' }
    }
  },
  episode: { id: 'ep1', title: '–≠–ø–∏–∑–æ–¥ 1. –•–æ–ª–ª', bg: 'assets/img/hall_back3.png', music: 'assets/audio/music_ep1.mp3' },
  episodesList: [
    { id:'ep1', title:'–≠–ø–∏–∑–æ–¥ 1', unlocked:true },
    { id:'ep2', title:'–≠–ø–∏–∑–æ–¥ 2', unlocked:false },
    { id:'ep3', title:'–≠–ø–∏–∑–æ–¥ 3', unlocked:false },
    { id:'ep4', title:'–≠–ø–∏–∑–æ–¥ 4', unlocked:false },
    { id:'ep5', title:'–≠–ø–∏–∑–æ–¥ 5', unlocked:false },
    { id:'ep6', title:'–≠–ø–∏–∑–æ–¥ 6', unlocked:false },
    { id:'ep7', title:'–≠–ø–∏–∑–æ–¥ 7', unlocked:false },
    { id:'ep8', title:'–≠–ø–∏–∑–æ–¥ 8', unlocked:false },
  ],
  objects: [
 
    { id:'obj_andre', img:'assets/img/obj_andre.png', model3d: 'assets/models/andre_model-v1.glb', x: 405, y: 721, rarity:'rare', secret:false, episode: 'ep1', scale: 0.22,  // ‚¨ÖÔ∏è 0.5 = 50% —Ä–∞–∑–º–µ—Ä–∞, 0.3 = 30%, 1.0 = 100%
    title:'Andre the giant has a posse', desc:'–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ Andre the Giant Has a Posse ‚Äî —ç—Ç–æ —Å—Ç—Ä–∏—Ç-–∞—Ä—Ç –∫–∞–º–ø–∞–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Ö—É–¥–æ–∂–Ω–∏–∫–æ–º –®–µ–ø–∞—Ä–¥–æ–º –§–µ–π—Ä–∏ –≤ 1989 –≥–æ–¥—É, –∫–æ–≥–¥–∞ –æ–Ω —É—á–∏–ª—Å—è –≤ –®–∫–æ–ª–µ –¥–∏–∑–∞–π–Ω–∞ –†–æ–¥-–ê–π–ª–µ–Ω–¥–∞. –ù–∞ —Å—Ç–∏–∫–µ—Ä–µ –∏–∑–æ–±—Ä–∞–∂—ë–Ω —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π —Ä–µ—Å—Ç–ª–µ—Ä –ê–Ω–¥—Ä–µ –ì–∏–≥–∞–Ω—Ç',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_andre.mp3' } },

    { id:'cosmo', img:'assets/img/cosmo.png', model3d: 'assets/models/cosmo_model-v4.glb', x: 1053, y: 535, rarity:'common', secret:false, episode: 'ep1', scale: 0.1, 
    title:'–§–∏–≥—É—Ä–∫–∞ –∫–æ—Å–º–æ–Ω–∞–≤—Ç–∞', desc:'–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∫—Ç–æ-–Ω–∏–±—É–¥—å –∫—Ä–æ–º–µ –º–µ–Ω—è –∑–∞–¥—É–º—ã–≤–∞–ª—Å—è, –ø–æ—á–µ–º—É –∫–æ—Å–º–æ–Ω–∞–≤—Ç—ã?',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_nya.mp3' } },

     { id:'logo_pg', img:'assets/img/obj_pg_logo.png', x: 1400, y: 140, rarity:'legendary', secret:false, episode: 'ep2', scale: 0.4, 
    title:'–õ–æ–≥–æ—Ç–∏–ø PG', desc:'—Ö–º–º.. –ø–æ—Ö–æ–∂–µ –Ω–∞ –ª–æ–≥–æ—Ç–∏–ø –æ–¥–Ω–æ–π –ß–í–ö.... —á—Ç–æ –æ–Ω –∑–¥–µ—Å—å –¥–µ–ª–∞–µ—Ç? –Ω–µ—É–∂–µ–ª–∏ –º–∞—Ä—à —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ –¥–æ—à–µ–ª –∏ –¥–æ –æ—Ñ–∏—Å–∞ –Ω–∞ —Ç—Ä–µ—Ö–≥–æ—Ä–Ω–æ–π –º–∞–Ω—É—Ñ–∞–∫—Ç—É—Ä–µ?',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_lookatyou.mp3' } },

     { id:'crocs', img:'assets/img/crocs.png', model3d: 'assets/models/crocs_model-v1.glb', x: 164, y: 780, rarity:'common', secret:false, episode: 'ep2', scale: 0.8, 
    title:'–ö—Ä–æ–∫—Å—ã', desc:'–Ω–∞–≤–µ—Ä–Ω–æ–µ –≥–æ—Ç–æ–≤—è—Ç –Ω–æ–≤—ã–π –º–µ—Ä—á –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.    –û –∫–æ—Ä–ø–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫—Ä–æ–∫—Å–∞—Ö —è –¥–∞–≤–Ω–æ –º–µ—á—Ç–∞—é)',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_gold_digger.mp3' } },

    { id:'obj_apple', img:'assets/img/obj_apple.png', model3d: 'assets/models/apple_model-v1.glb', x: 500, y: 480, rarity:'common', secret:false, episode: 'ep3', scale: 0.3, 
    title:'–Ø–±–ª–æ–∫–æ', desc:'–µ—â–µ –Ω–µ –ë–ê–î, –Ω–æ —É–∂–µ —Ö–æ—Ä–æ—à–æ. –ü–æ–µ–¥–µ—Ç –∫–æ –º–Ω–µ –¥–æ–º–æ–π!',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_ukus.mp3' } },

     { id:'medal', img:'assets/img/medal.png', model3d: 'assets/models/medal_model-v1.glb', x: 1400, y: 290, rarity:'legendary', secret:false, episode: 'ep3', scale: 0.25, 
    title:'–ó–æ–ª–æ—Ç–∞—è –º–µ–¥–∞–ª—å', desc:'–ë–æ—Ä–∏—Å—É –ú–∏—Ö–∞–ª—ã—á—É, –∑–∞ –ø–æ–±–µ–¥—É –ø—Ä–∏ —Ç—Ä–µ—Ö–≥–æ—Ä–∫–µ 25.12.2025',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_ctmn.mp3' } },

    { id:'BAD', img:'assets/img/pills.png', model3d: 'assets/models/pills_model-v1.glb', x: 650, y: 800, rarity:'common', secret:false, episode: 'ep3', scale: 0.3, 
    title:'–ë–ê–î—ã', desc:'–∫–∞–∫–∏–µ-—Ç–æ –ø–∏–ª—é–ª–∏, –ø–æ—Ö–æ–∂–∏ –Ω–∞ –ë–ê–î.. –ê –∫–∞–∫ —Ç–æ—á–Ω–æ –ø–æ–Ω—è—Ç—å? –í—Ä–æ–¥–µ –±—ã –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ, –∑–Ω–∞—á–∏—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤–æ, –∞ –µ—Å–ª–∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - –ë–ê–î—ã',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_swallow.mp3' } },

    { id:'babok', img:'assets/img/babok.png', x: 1200, y: 900, rarity:'rare', secret:false, episode: 'ep4', scale: 1, 
    title:'BABOK', desc:'–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∫ –°–≤–æ–¥—É –∑–Ω–∞–Ω–∏–π –ø–æ –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏–∑—É. –ù–∞ –æ–∑–æ–Ω–µ –∑–∞ –Ω–µ–≥–æ –ø—Ä–æ—Å—è—Ç 12 —Ç—ã—Å—è—á, –ª—É—á—à–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∑–∞–≥—É–≥–ª—é –∫–∞–∫ –º–Ω–µ BPMN-—Å—Ö–µ–º–∫–∏ —Ä–∏—Å–æ–≤–∞—Ç—å',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_babok.mp3' } },

    { id:'maga', img:'assets/img/maga.png', x: 1400, y: 350, rarity:'epic', secret:false, episode: 'ep4', scale: 0.7, 
    title:'MAGA', desc:'MAGA movement, nativist political movement that emerged in the United States during the 2016 presidential campaign of its putative leader, Donald Trump. Its name is derived from Trump‚Äôs 2016 campaign slogan ‚ÄúMake America Great Again,‚Äù which has been a rallying cry for many Trump supporters ever since.',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_fake_news.mp3' } },

     { id:'cap', img:'assets/img/fill_shapka.png', model3d: 'assets/models/fill_cap_model-v1.glb', x: 770, y: 300, rarity:'epic', secret:false, episode: 'ep5', scale: 1.8, 
    title:'–≠—Å—Ç—Ä–∞–¥–Ω—ã–π –ø–ª—é–º–∞–∂', desc:'–∫–∞–∫–∞—è-—Ç–æ –∫–∞—Ä–Ω–∞–≤–∞–ª—å–Ω–∞—è —à–∞–ø–∫–∞ —Å –ø–µ—Ä—å—è–º–∏, —Å—É–¥—è –ø–æ –≤—Å–µ–º—É, –∫–æ—Ä–æ–ª—å —ç—Å—Ç—Ä–∞–¥—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–±—Ä–∞–ª –µ–µ —É —à–≤–µ–∏, –∫–æ—Ç–æ—Ä–∞—è —Å –Ω–∞–º–∏ –ø–æ —Å–æ—Å–µ–¥—Å—Ç–≤—É –¥–µ–ª–∏—Ç —ç—Ç–∞–∂',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_pink_wig.mp3' } },

    { id:'telephone', img:'assets/img/telephone2.png', model3d: 'assets/models/telephone_model-v1.glb', x: 400, y: 800, rarity:'common', secret:false, episode: 'ep6', scale: 0.7, 
    title:'–°–æ—Ç–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω', desc:'—á–µ—Ç–∫–∞—è –º–æ–±–∏–ª–∞, –ø—Ä—è–º–∏–∫–æ–º –∏–∑ –º–æ–ª–æ–¥–æ—Å—Ç–∏ –í–∏–ª–ª–∏',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_skype.mp3' } },

    { id:'–ö–æ–Ω—Ç—Ä–æ—Ü–µ–ø—Ç–∏–≤', img:'assets/img/preservation2.png', model3d: 'assets/models/condom_model-v1.glb', x: 150, y: 135, rarity:'SEXY', secret:false, episode: 'ep6', scale: 0.2, 
    title:'–ü—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π', desc:'–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –∏–∑–¥–µ–ª–∏–µ. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª–∞, –≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –ü–µ—Ç—Ä –ê–ª–µ–∫—Å–µ–µ–≤–∏—á –ø—Ä–∏–Ω–æ—Å–∏–ª –∑–∞—Ü–µ–Ω–∏—Ç—å.', visible: false, zIndex: 20,  
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_losing.mp3' } },  

    { id:'–í–µ—Ç–∏–∫–∏', img:'assets/img/vet_pills.png', model3d: 'assets/models/vet_pills_model-v1.glb', x: 400, y: 440, rarity:'common', secret:false, episode: 'ep6', scale: 0.5, 
    title:'–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç', desc:'–°–æ–±–∞—á–∫–∏ —Ç–æ–∂–µ –∏–Ω–æ–≥–¥–∞ –±–æ–ª–µ—é—Ç. –•–æ—Ä–æ—à–æ, —á—Ç–æ –í–∏–ª–ª–∏ #–Ω–µ–≤—Å–µ—Ä–∞–≤–Ω–æ –∏ –æ–Ω –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –Ω–∏—Ö', 
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_dog.mp3' } },

    { id:'Note', img:'assets/img/note.png', model3d: 'assets/models/note.glb', x: 1300, y: 570, rarity:'common', secret:false, episode: 'ep6', scale: 0.4, 
    title:'–°—Ç–∏–∫–µ—Ä', desc:'–º–æ—è –ø—Ä–µ–ª–µ—Å—Ç—å, –º–æ—è –≥–æ—Ä–¥–æ—Å—Ç—å - –ü–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –†–§ –æ—Ç 27.05.2024 –≥. ‚Ññ <u>675</u>', 
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_forreal.mp3' } },

    { id:'–≠–¢–ê–ù–û–õ', img:'assets/img/ethanol.png', model3d: 'assets/models/ethanol_model-v1.glb', x: 630, y: 520, rarity:'rare', secret:false, episode: 'ep7', scale: 0.07, 
    title:'–ë—É—Ç—ã–ª—å —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –Ω–µ–∫—É—é —Å—É–±—Å—Ç–∞–Ω—Ü–∏—é', desc:'–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–≥—Ä–µ–≤–∞–µ—Ç!',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_goodkush.mp3' } },

    { id:'Matrix', img:'assets/img/matrix_toy.png', model3d: 'assets/models/matrix_toy_model-v1.glb', x: 1200, y: 570, rarity:'epic', secret:false, episode: 'ep7', scale: 0.1, 
    title:'SuperMatrix', desc:'—á–µ–π-—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –∫–æ—Ç –º–∞—Å–∫–æ—Ç. –í–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –∏ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_wu_tang.mp3' } },

    { id:'obj_cigarette', img:'assets/img/obj_cigarette.png', model3d: 'assets/models/marlboro_model-v1.glb', x: 900, y: 770, rarity:'common', secret:false, episode: 'ep8', scale: 0.22,  // ‚¨ÖÔ∏è 0.5 = 50% —Ä–∞–∑–º–µ—Ä–∞, 0.3 = 30%, 1.0 = 100%
    title:'–ü–∞—á–∫–∞ Marlboro', desc:'–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –∫–∞—Ä–º–∞–Ω–µ –ø–∞—á–∫–∞ —Å–∏–≥–∞—Ä–µ—Ç.... –í–æ—Ç —Ç–æ–ª—å–∫–æ –æ–Ω–∞ –Ω–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ—Ö–æ–∂–µ, —Ç–∞–±–∞—á–Ω–∏–∫–∏ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å –∫–æ–Ω—Ç—Ä–∞—Ñ–∞–∫—Ç–æ–º...',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_smoke.mp3' } },

    { id:'DOBERMAN', img:'assets/img/doberman.png', model3d: 'assets/models/doberman_model-v1.glb', x: 500, y: 80, rarity:'epic', secret:false, episode: 'ep8', scale: 0.22,  // ‚¨ÖÔ∏è 0.5 = 50% —Ä–∞–∑–º–µ—Ä–∞, 0.3 = 30%, 1.0 = 100%
    title:'–î–û–ë–ï–†–ú–ê–ù', desc:'–¥–∞ —á—Ç–æ –∑–¥–µ—Å—å –≤–æ–æ–±—â–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? –æ—Ç–∫—É–¥–∞ –æ–Ω —Ç–∞–º –≤–∑—è–ª—Å—è?',
    sfx:{ click:'assets/audio/sfx_hover.mp3', take:'assets/audio/sfx_dmx.mp3' } },

   
    { 
      id: 'safe', 
      img: 'assets/img/vault_close2.png',  
      x: 150, 
      y: 170, 
      rarity: 'epic', 
      secret: false, 
      episode: 'ep6', 
      scale: 0.7,
      title: '–ö–æ–¥–æ–≤—ã–π —Å–µ–π—Ñ', 
      desc: '–°—Ç–∞—Ä—ã–π —Å–µ–π—Ñ —Å –∫–æ–¥–æ–≤—ã–º –∑–∞–º–∫–æ–º. –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏?',
      zIndex: 10,  
      interactive: true, 
      action: function() {
        if (state.safeCracked) {
          showMessage('–°–µ–π—Ñ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç.');
        } else {
          openSafeCrackGame();
        }
      },
      sfx: { 
        
        take: 'assets/audio/sfx_pink_wig.mp3' 
      } 
    },



  ], 

  dialogue: DIALOGS.ep1
};

const state = {
  nickname: localStorage.getItem('nickname') || '',
  score: Number(localStorage.getItem('score')||0),
  taken: JSON.parse(localStorage.getItem('taken')||'[]'),
  dialogueIndex: Number(localStorage.getItem('dlgIdx')||0),
  editor: false,
    disclaimerShown: false,
  persona: localStorage.getItem('persona') || CONFIG.persona.selected,
};
const $ = sel => document.querySelector(sel);
function save(){localStorage.setItem('nickname', state.nickname);localStorage.setItem('score', String(state.score));localStorage.setItem('taken', JSON.stringify(state.taken));localStorage.setItem('dlgIdx', String(state.dialogueIndex)); disclaimerShown: state.disclaimerShown,localStorage.setItem('persona', state.persona);}
function validNick(n){ return /^[A-Za-z0-9_]{3,16}$/.test(n); }
function playSfx(src){ if(!src) return; const a=new Audio(src); a.volume=0.9; a.play().catch(()=>{}); }
const music = new Audio(); music.loop = true; music.volume = 0.6;
function playEpisodeMusic(src){ if(!src) return; music.src = src; music.play().catch(()=>{}); }
function playMenuMusic(){music.src = 'assets/audio/main_theme2.mp3';music.loop = true;music.volume = 0.6;music.play().catch(()=>{});}
const bg = $('#bg');
function loadScene(){ bg.style.backgroundImage = `url(${CONFIG.episode.bg})`; }
const invGrid = $('#invGrid');
function buildInventory() {
  invGrid.innerHTML = '';
  
  const cells = CONFIG.inventory.cols * CONFIG.inventory.rows;
  for(let i = 0; i < cells; i++) { 
    const c = document.createElement('div'); 
    c.className = 'cell'; 
    invGrid.appendChild(c); 
  }
  
  const imgs = CONFIG.objects.filter(o => state.taken.includes(o.id));
  imgs.forEach((o, idx) => {
    const cell = invGrid.children[idx]; 
    if(!cell) return;
    
    const im = document.createElement('img'); 
    im.src = o.img; 
    im.alt = o.title; 
    im.title = o.title + ' (–∫–ª–∏–∫ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ 3D)';
    
    
    cell.style.cursor = 'pointer';
    cell.style.transition = 'transform 0.2s, box-shadow 0.2s';
    
    cell.onmouseenter = () => {
      cell.style.transform = 'scale(1.05)';
      cell.style.boxShadow = '0 0 15px rgba(255, 217, 59, 0.4)';
    };
    
    cell.onmouseleave = () => {
      cell.style.transform = 'scale(1)';
      cell.style.boxShadow = 'none';
    };
    
    cell.onclick = () => {
      playSfx('assets/audio/sfx_security.mp3');  
      open3DViewer(o);
    };
    
    cell.appendChild(im);
  });
   updateInventoryPoints();
}

let ctxEl = null;

let isRendering = false;
let renderCount = 0;


let CACHED_SCENE_WIDTH = null;
let CACHED_SCENE_HEIGHT = null;

function updateInventoryPoints() {
  const pointsElement = document.getElementById('inventoryPoints');
  
  if (!pointsElement) return;
  
 
  pointsElement.textContent = `${state.score} pts`;
  
  console.log('üí∞ –í—Å–µ–≥–æ –æ—á–∫–æ–≤:', state.score);
    saveResultToFirebase();
}


function cacheSceneDimensions() {
    CACHED_SCENE_WIDTH = window.innerWidth;
    CACHED_SCENE_HEIGHT = window.innerHeight;
    console.log(`üìê CACHED scene dimensions: ${CACHED_SCENE_WIDTH} x ${CACHED_SCENE_HEIGHT}`);
}

function renderObjects() {
    renderCount++;
    console.log(`üé¨ ========== RENDER #${renderCount} START ==========`);
    
    if (isRendering) {
        console.warn('‚ö†Ô∏è BLOCKED: Already rendering!');
        return;
    }
    
    isRendering = true;
    
    requestAnimationFrame(() => {
        const currentEpisode = CONFIG.episode.id;
        const episodeObjects = CONFIG.objects.filter(o => 
            o.episode === currentEpisode || !o.episode
        );
        
        const BASE_WIDTH = 1536;
        const BASE_HEIGHT = 1024;
        
        
        const sceneWidth = CACHED_SCENE_WIDTH || window.innerWidth;
        const sceneHeight = CACHED_SCENE_HEIGHT || window.innerHeight;
        
        console.log(`üìê Using cached: ${sceneWidth} x ${sceneHeight}`);
        console.log(`ü™ü Current window: ${window.innerWidth} x ${window.innerHeight}`);
        
        const scaleX = sceneWidth / BASE_WIDTH;
        const scaleY = sceneHeight / BASE_HEIGHT;
        const scale = Math.min(scaleX, scaleY);
        
        const actualWidth = BASE_WIDTH * scale;
        const actualHeight = BASE_HEIGHT * scale;
        
        const offsetX = (sceneWidth - actualWidth) / 2;
        const offsetY = (sceneHeight - actualHeight) / 2;
        
        console.log(`‚öôÔ∏è Scale: ${scale.toFixed(3)}, Offset: (${offsetX.toFixed(0)}, ${offsetY.toFixed(0)})`);
        
        
        scene.querySelectorAll('.obj').forEach(n => n.remove());
        
    episodeObjects.forEach(o => {
    if (state.taken.includes(o.id)) {
        console.log(`‚è≠Ô∏è Skip: ${o.id} (already taken)`);
        return;
    }
    
    if (o.visible === false) {
        console.log(`üôà Hidden: ${o.id} (visible === false)`);
        return;
    }

    const itemX = offsetX + (o.x * scale);
    const itemY = offsetY + (o.y * scale);
    
    console.log(`üìç ${o.id}: base (${o.x}, ${o.y}) ‚Üí screen (${itemX.toFixed(1)}, ${itemY.toFixed(1)})`);
    
    const wrap = document.createElement('div');
    wrap.className = 'obj';
    wrap.dataset.itemId = o.id;
    wrap.style.left = `${itemX}px`;
    wrap.style.top = `${itemY}px`;
    wrap.style.transform = `translate(-50%, -50%)`;

    if (typeof o.zIndex !== 'undefined') {
        wrap.style.zIndex = String(o.zIndex);
    }
    
    const im = document.createElement('img');
    im.src = o.img;
    im.alt = o.title;
    
    if (o.scale) {
        im.style.transform = `scale(${o.scale})`;
        im.style.transformOrigin = 'center center';
    }
    
    
    im.addEventListener('mousedown', (e) => {
        playSfx(o.sfx?.click);
        if (state.editor) startDrag(e, o, wrap);
    });
    
   
im.addEventListener('click', (e) => {
    if (state.editor) return;
    
    
    if (o.action && typeof o.action === 'function') {
        console.log('üéÆ –í—ã–∑–æ–≤ action –¥–ª—è:', o.id);
        o.action(); 
        return; 
    }
    
    
    openContext(o, e.clientX, e.clientY);
});

    
    wrap.appendChild(im);
    scene.appendChild(wrap);
});

isRendering = false;
console.log(`========== RENDER #${renderCount} END ==========`);
    
    }
)}





let current3DScene = null;  

function open3DViewer(obj) {
  
  if (!obj.model3d) {
    alert('–£ —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –ø–æ–∫–∞ –Ω–µ—Ç 3D-–º–æ–¥–µ–ª–∏ üòî');
    return;
  }
  
 
  const viewer = document.createElement('div');
  viewer.className = 'model-viewer open';
  viewer.id = 'modelViewer';
  viewer.innerHTML = `
    <button class="model-close">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
    <canvas id="modelCanvas" class="model-canvas"></canvas>
    <div class="model-info">
      <h2>${obj.title}</h2>
      <p>${obj.desc}</p>
      <p class="model-hint">üñ±Ô∏è –ó–∞–∂–º–∏ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è | –ö–æ–ª—ë—Å–∏–∫–æ –¥–ª—è –∑—É–º–∞</p>
    </div>
  `;
  
  document.body.appendChild(viewer);
  
  
  viewer.querySelector('.model-close').onclick = () => close3DViewer();
  
 
  viewer.onclick = (e) => {
    if (e.target === viewer) close3DViewer();
  };
  
  
  setTimeout(() => init3DModel(obj.model3d), 100);
}

function close3DViewer() {
  const viewer = document.getElementById('modelViewer');
  if (viewer) {
    viewer.remove();
  }
  
  
  if (current3DScene) {
    current3DScene.dispose();
    current3DScene = null;
  }
}

async function init3DModel(modelPath) {
  const canvas = document.getElementById('modelCanvas');
  if (!canvas) return;
  
 
  const THREE = await import('three');
  const { GLTFLoader } = await import('three/addons/loaders/GLTFLoader.js');
  const { OrbitControls } = await import('three/addons/controls/OrbitControls.js');
  const { MeshoptDecoder } = await import('https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/libs/meshopt_decoder.module.js');
  
  console.log('Three.js –∑–∞–≥—Ä—É–∂–µ–Ω');
  
  
  const scene = new THREE.Scene();
  
  
  
  const camera = new THREE.PerspectiveCamera(
    50,
    canvas.offsetWidth / canvas.offsetHeight,
    0.1,
    1000
  );
  camera.position.set(0, 1, 3);
  
 
  const renderer = new THREE.WebGLRenderer({ 
    canvas, 
    antialias: true,
    alpha: true 
  });
  renderer.setSize(canvas.offsetWidth, canvas.offsetHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  
  console.log('–†–µ–Ω–¥–µ—Ä–µ—Ä —Å–æ–∑–¥–∞–Ω');
  
  
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(ambientLight);
  
  const directionalLight1 = new THREE.DirectionalLight(0xffd93b, 0.8);
  directionalLight1.position.set(5, 10, 7);
  scene.add(directionalLight1);
  
  const directionalLight2 = new THREE.DirectionalLight(0x4a9eff, 0.3);
  directionalLight2.position.set(-5, -5, -5);
  scene.add(directionalLight2);
  
  console.log('–û—Å–≤–µ—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
  
  
  const loader = new GLTFLoader();
  loader.setMeshoptDecoder(MeshoptDecoder);
  console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏:', modelPath);
  
  loader.load(
    modelPath,
    (gltf) => {
      console.log('–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', gltf);
      const model = gltf.scene;
      
      // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
      const box = new THREE.Box3().setFromObject(model);
      const center = box.getCenter(new THREE.Vector3());
      model.position.sub(center);
      
      // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
      const size = box.getSize(new THREE.Vector3());
      const maxDim = Math.max(size.x, size.y, size.z);
      const scale = 2 / maxDim;
      model.scale.setScalar(scale);
      
      scene.add(model);
      console.log('–ú–æ–¥–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å—Ü–µ–Ω—É');
    },
    (xhr) => {
      const percent = (xhr.loaded / xhr.total * 100).toFixed(0);
      console.log(`–ó–∞–≥—Ä—É–∑–∫–∞: ${percent}%`);
    },
    (error) => {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å 3D-–º–æ–¥–µ–ª—å');
    }
  );
  
  
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 2;
  
  console.log('OrbitControls –¥–æ–±–∞–≤–ª–µ–Ω—ã');
  
  
  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();
  
  console.log('–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω');
  
  
  window.addEventListener('resize', () => {
    camera.aspect = canvas.offsetWidth / canvas.offsetHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(canvas.offsetWidth, canvas.offsetHeight);
  });
  
  
  current3DScene = { 
    scene, 
    renderer, 
    controls, 
    dispose: () => {
      controls.dispose();
      renderer.dispose();
    }
  };
}



function openContext(obj, x, y){
    console.log('üìã Opening context for:', obj.id);
  closeContext();
  const d=document.createElement('div');
  d.className='ctx';
  
 
  
  d.style.transform='translate(-50%, -50%)';
  
  d.innerHTML=`<h3>${obj.title}</h3><p>${obj.desc}</p>
    <div class="row"><button class="btn" data-act="leave">–û—Å—Ç–∞–≤–∏—Ç—å</button><button class="btn" data-act="take">–í–∑—è—Ç—å</button></div>`;
  d.addEventListener('click', e=>{
    const act = e.target?.dataset?.act;
    if(!act) return;
    if(act==='leave') {
            console.log('üëã Leave clicked');
            closeContext();
        }
    if(act==='take'){
            console.log('üñ±Ô∏è Take clicked for:', obj.id);
            takeObject(obj);
           
        }
    });
  document.body.appendChild(d);
  ctxEl=d;
}
function closeContext(){
    console.log('üö™ closeContext called');
    if (ctxEl) {
        console.log('Removing context popup');
        ctxEl.remove();
        ctxEl = null;
    } else {
        console.log('Context already closed');
    }
}
function takeObject(obj) {
      console.log('üéØ ========== TAKING OBJECT ==========');
    console.log('Object:', obj.id);
    console.log('Taken before:', state.taken);

    const pts = CONFIG.scoring[obj.rarity] || 0;
    state.score += pts;
    state.taken.push(obj.id);
    console.log('Taken after:', state.taken);
    showScorePop(pts);
    showRarityBanner(obj.rarity);
    playSfx(obj.sfx?.take);
    
    save();
    buildInventory();

    

    console.log('üö™ Closing context...');
    closeContext();
    
    
    setTimeout(() => {
        console.log('üîÑ Rendering objects...');
        renderObjects();
    }, 50);
    
    maybeShowGoldDigger();
     console.log('========== TAKE COMPLETE ==========');
}
function showScorePop(n){ const d=document.createElement('div'); d.className='score-pop'; d.textContent = `+${n}`; $('#app').appendChild(d); setTimeout(()=>d.remove(), 3000); }
function showRarityBanner(rarity) {
  const banners = {
    common: { text: '–û–ë–´–ß–ù–´–ô', color: '#8b8b95', glow: 'rgba(139, 139, 149, 0.5)' },
    rare: { text: '–†–ï–î–ö–ò–ô', color: '#4a9eff', glow: 'rgba(74, 158, 255, 0.6)' },
    epic: { text: '–≠–ü–ò–ß–ï–°–ö–ò–ô', color: '#a335ee', glow: 'rgba(163, 53, 238, 0.6)' },
    legendary: { text: '–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô!', color: '#ff8000', glow: 'rgba(255, 128, 0, 0.7)' },
    SEXY: { text: 'SEXY', color: '#ff007f', glow: 'rgba(255, 0, 127, 0.7)' }
  };
  
  const config = banners[rarity];
  if (!config) return;
  
  const b = document.createElement('div');
  b.className = 'rarity-banner';
  b.textContent = config.text;
  b.style.cssText = `
    position: fixed;
    left: 50%;
    top: 40%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    font-weight: 900;
    color: ${config.color};
    text-shadow: 0 0 16px ${config.glow}, 0 0 28px ${config.glow};
    letter-spacing: 3px;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    animation: rarityFlash 1.5s ease-out forwards;
  `;
  
  document.body.appendChild(b);
  setTimeout(() => b.remove(), 1500);
}


function maybeShowGoldDigger() {
  const totalItems = CONFIG.objects.length;  
  
 
  if (totalItems > 0 && state.taken.length >= totalItems) {
    const b = document.createElement('div'); 
    b.id='goldDiggerBanner'; 
    b.textContent='GOLD DIGGER';
    b.style.cssText = `
      position: fixed;
      left: 50%;
      top: 25%;
      transform: translate(-50%, -50%);
      font-size: 56px;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 16px #ffef99, 0 0 28px #e0b500;
      letter-spacing: 3px;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      animation: goldFlash 4.0s ease-out forwards;
    `;
    document.body.appendChild(b);
    setTimeout(() => b.remove(), 2000);
  }
}


function fadeOutAndLoadEpisode(nextId, idx) {
  console.log('–ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞', nextId);
  
  const overlay = document.getElementById('transitionOverlay');
  
  
  overlay.classList.add('active');
  
  
  setTimeout(() => {
    console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —ç–ø–∏–∑–æ–¥–∞', nextId);
    loadNextEpisode(nextId, idx);
    
   
    setTimeout(() => {
      console.log('‚ú® –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π —ç–ø–∏–∑–æ–¥');
      overlay.classList.remove('active');
    }, 500);
  }, 1000); 
}


function getMatrixPortrait() {const p = CONFIG.persona.options[state.persona] || CONFIG.persona.options.classic;return p.portrait;}
let currentTypeTimer = null; 


function typeText(text, color) {
  const dlgText = document.getElementById('dialogText');
  
  if(!dlgText) {
    console.error('dialogText element not found!');
    return;
  }
  
  if (currentTypeTimer) {
    clearInterval(currentTypeTimer);
    currentTypeTimer = null;
  }
  
  dlgText.innerHTML = '';
  dlgText.style.display = 'block';
  dlgText.style.visibility = 'visible';
  
  
  if (color) {
    dlgText.style.color = color;
  } else {
    dlgText.style.color = 'var(--neon)';
  }
  
  
  const temp = document.createElement('div');
  temp.innerHTML = text;
  
  
  const nodes = Array.from(temp.childNodes);
  
  let currentIndex = 0;
  let currentNodeIndex = 0;
  
  currentTypeTimer = setInterval(() => {
    if (currentNodeIndex >= nodes.length) {
      clearInterval(currentTypeTimer);
      currentTypeTimer = null;
      return;
    }
    
    const node = nodes[currentNodeIndex];
    
    
    if (node.nodeType === Node.TEXT_NODE) {
      const text = node.textContent;
      if (currentIndex < text.length) {
        dlgText.appendChild(document.createTextNode(text[currentIndex]));
        currentIndex++;
      } else {
        currentIndex = 0;
        currentNodeIndex++;
      }
    } 
   
    else if (node.nodeType === Node.ELEMENT_NODE) {
      const clonedNode = node.cloneNode(false); 
      dlgText.appendChild(clonedNode);
      
      const innerText = node.textContent;
      let innerIndex = 0;
      
      const innerTimer = setInterval(() => {
        if (innerIndex < innerText.length) {
          clonedNode.textContent += innerText[innerIndex];
          innerIndex++;
        } else {
          clearInterval(innerTimer);
        }
      }, 60);
      
      currentNodeIndex++;
    }
  }, 60);
}

const DOOR_CODE = ['0', '4', '3']; 
let pressedKeys = new Set(); 


function showDoorLock() {
  const lock = document.getElementById('doorLock');
  lock.style.display = 'flex';
  
  pressedKeys.clear();
  
  
  document.querySelectorAll('.lock-btn').forEach(btn => {
    btn.addEventListener('mousedown', (e) => handlePress(e.target.dataset.digit));
    btn.addEventListener('mouseup', (e) => handleRelease(e.target.dataset.digit));
    btn.addEventListener('mouseleave', (e) => handleRelease(e.target.dataset.digit));
  });
  
  
  document.addEventListener('keydown', handleKeyDown);
  document.addEventListener('keyup', handleKeyUp);
}

function closeDoorLock() {
  const lock = document.getElementById('doorLock');
  lock.style.display = 'none';
  
  document.removeEventListener('keydown', handleKeyDown);
  document.removeEventListener('keyup', handleKeyUp);
}


function handlePress(digit) {
  pressedKeys.add(digit);
  
  
  document.querySelectorAll(`.lock-btn[data-digit="${digit}"]`).forEach(btn => {
    btn.classList.add('pressed');
  });
  
  checkCode();
}


function handleRelease(digit) {
  pressedKeys.delete(digit);
  
 
  document.querySelectorAll(`.lock-btn[data-digit="${digit}"]`).forEach(btn => {
    btn.classList.remove('pressed');
  });
}


function handleKeyDown(e) {
  const digit = e.key;
  if (/^[0-9]$/.test(digit) && !pressedKeys.has(digit)) {
    handlePress(digit);
  }
}

function handleKeyUp(e) {
  const digit = e.key;
  if (/^[0-9]$/.test(digit)) {
    handleRelease(digit);
  }
}


function checkCode() {
  const status = document.querySelector('.lock-status');
  
  const isCorrect = DOOR_CODE.every(digit => pressedKeys.has(digit)) 
                    && pressedKeys.size === DOOR_CODE.length;
  
  if (isCorrect) {
    status.textContent = '–î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–∞!';
    status.style.color = '#4ade80';
    
    setTimeout(() => {
      closeDoorLock();
      
      
      const cur = CONFIG.episode.id;
      const idx = window.EP_ORDER.indexOf(cur);
      const nextId = window.EP_ORDER[idx + 1];
      
      fadeOutAndLoadEpisode(nextId, idx); 
    }, 1000);
  }
}



function stepDialogue() {
   const currentDialogue = DIALOGS[CONFIG.episode.id] || CONFIG.dialogue;
  const node = currentDialogue ? currentDialogue[state.dialogueIndex] : null;
 
  console.log('üìç stepDialogue –≤—ã–∑–≤–∞–Ω');
  console.log('–≠–ø–∏–∑–æ–¥:', CONFIG.episode.id);
  console.log('–ò–Ω–¥–µ–∫—Å:', state.dialogueIndex);
  console.log('Node:', node);

  if (node && node.type === 'coffeeGame') {
    console.log('‚òï –ó–∞–ø—É—Å–∫ –∫–æ—Ñ–µ-–∏–≥—Ä—ã');
    showCoffeeGame();
    return;
  }
  
  const dlgWrap = document.getElementById('dialog');
  const dlgText = document.getElementById('dialogText');
  const choices = document.getElementById('choices');
  const portrait = document.getElementById('portrait');
  
  if (!node) {
    
    if (dlgWrap) dlgWrap.style.display = 'none';
    if (CONFIG.episode.id === 'ep2') {    
      console.log('üîí –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–º–æ–∫');
      showDoorLock();
      return; 
    }
    if (typeof window.onEpisodeComplete === 'function') {
      setTimeout(() => window.onEpisodeComplete(), 3000);
    }
    return;
  }
  
  if (choices) choices.innerHTML = '';
  
  if (node.choices) {
    typeText('–í—ã–±–æ—Ä‚Ä¶');
    node.choices.forEach(ch => {
      const b = document.createElement('button');
      b.className = 'btn';
      b.textContent = ch.text;
      b.onclick = () => {
        state.dialogueIndex = ch.goto;
        save();
        stepDialogue();
      };
      if (choices) choices.appendChild(b);
    });
    if (portrait) portrait.src = getMatrixPortrait();
  } else {
   
    if (portrait) {
      if (node.speaker === 'matrix') {
        portrait.src = getMatrixPortrait();
      } else if (node.portrait) {
        portrait.src = node.portrait;  
      } else {
        portrait.src = getMatrixPortrait();  
      }
    }
    if (dlgText) dlgText.textContent = '';
    typeText(node.text, node.textColor);
  }

}
function showDialogue() {const dlg = document.getElementById('dialog');if (dlg) dlg.style.display = 'flex';state.dialogueIndex = 0;stepDialogue();}
function showEpisodeTitle(){ const t=$('#epTitle'); $('#epTitleText').textContent = CONFIG.episode.title; t.classList.add('show'); setTimeout(()=>{ t.classList.remove('show'); }, 2000); }
let drag={active:false, dx:0, dy:0, el:null, obj:null};
function startDrag(e, obj, el){ drag.active=true; drag.el=el; drag.obj=obj; drag.dx=e.clientX - obj.x; drag.dy=e.clientY - obj.y; window.addEventListener('mousemove', onDrag); window.addEventListener('mouseup', stopDrag); }
function onDrag(e) {
  if(!drag.active) return;
  
  
  const newX = e.clientX - drag.dx;
  const newY = e.clientY - drag.dy;
  
 
  drag.el.style.left = newX + 'px';
  drag.el.style.top = newY + 'px';
  
  
}

function stopDrag() {
    if (!drag.active) return;
    
    if (state.editor) {
        
        const BASE_WIDTH = 1536;
        const BASE_HEIGHT = 1024;
        
        const sceneWidth = CACHED_SCENE_WIDTH || window.innerWidth;
        const sceneHeight = CACHED_SCENE_HEIGHT || window.innerHeight;
        
        const scaleX = sceneWidth / BASE_WIDTH;
        const scaleY = sceneHeight / BASE_HEIGHT;
        const scale = Math.min(scaleX, scaleY);
        
        const actualWidth = BASE_WIDTH * scale;
        const actualHeight = BASE_HEIGHT * scale;
        
        const offsetX = (sceneWidth - actualWidth) / 2;
        const offsetY = (sceneHeight - actualHeight) / 2;
        
       
        const screenX = parseInt(drag.el.style.left);
        const screenY = parseInt(drag.el.style.top);
        
        
        const baseX = Math.round((screenX - offsetX) / scale);
        const baseY = Math.round((screenY - offsetY) / scale);
        
        
        drag.obj.x = baseX;
        drag.obj.y = baseY;
        
        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
        console.log(`–ü—Ä–µ–¥–º–µ—Ç –ø–µ—Ä–µ–º–µ—â—ë–Ω: ${drag.obj.id}`);
        console.log(`   –≠–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: (${screenX}, ${screenY})`);
        console.log(`   –ë–∞–∑–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: (${baseX}, ${baseY})`);
        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
        console.log('–°–∫–æ–ø–∏—Ä—É–π –≤ –∫–æ–¥:');
        console.log(`   x: ${baseX},`);
        console.log(`   y: ${baseY},`);
        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
    }
    
    drag.active = false;
    window.removeEventListener('mousemove', onDrag);
    window.removeEventListener('mouseup', stopDrag);
}

function stopDrag(){ if(!drag.active) return; drag.active=false; window.removeEventListener('mousemove', onDrag); window.removeEventListener('mouseup', stopDrag); }
function openMenu(){const m = document.getElementById('mainMenu');m.hidden = false;document.body.classList.add('menu-open');playMenuMusic();}
function closeMenu() {
    state.dialogueIndex = 0;
    
    const m = document.getElementById('mainMenu');
    m.style.display = 'none';
    m.hidden = true;
    document.body.classList.remove('menu-open');
    
    loadScene();
    

    setTimeout(() => {
        cacheSceneDimensions(); 
        renderObjects();
        
        const dlg = document.getElementById('dialog');
        if (dlg) {
            dlg.style.cssText = 'position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); display: flex !important; visibility: visible !important; z-index: 35;';
            stepDialogue();
        }
    }, 500);

    playEpisodeMusic(CONFIG.episode.music);
    showEpisodeTitle();
    
   wireUI();
}


const PERSONA_ORDER = ['classic','vampire','lovelas'];
function openPersonaCarousel(){const cur = state.persona || 'classic'; let idx = Math.max(0, PERSONA_ORDER.indexOf(cur));const modal = document.createElement('div'); modal.className='main-menu';modal.style.background = "center / cover no-repeat url('assets/img/pers_back.jpg')";const card = document.createElement('div'); card.className='menu-card'; card.style.maxWidth='560px';card.innerHTML = `<h1>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h1><div style="position:relative;display:flex;align-items:center;justify-content:center;height:360px;overflow:hidden"><img id="pLeft"  style="position:absolute;right:57%;width:180px;opacity:.35;filter:grayscale(40%);border-radius:50%;border:2px solid rgba(0,0,0,.2);"><img id="pCenter" style="width:330px;border-radius:50%;"><img id="pRight" style="position:absolute;left:57%;width:180px;opacity:.35;filter:grayscale(40%);border-radius:50%;border:2px solid rgba(0,0,0,.2);"><button id="pPrev" class="btn" style="position:absolute;left:8px;top:calc(50% - 18px)">&larr;</button><button id="pNext" class="btn" style="position:absolute;right:8px;top:calc(50% - 18px)">&rarr;</button></div><div id="pName" style="text-align:center;font-weight:700;margin-top:4px"></div><div style="display:flex;justify-content:center;gap:12px;margin-top:10px"><button id="pChoose" class="btn">–í—ã–±—Ä–∞—Ç—å</button><button id="pClose" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button></div>`;modal.appendChild(card); document.body.appendChild(modal);const pLeft = card.querySelector('#pLeft');const pCenter = card.querySelector('#pCenter');const pRight = card.querySelector('#pRight');const pName = card.querySelector('#pName');function at(i){ return CONFIG.persona.options[PERSONA_ORDER[(i+PERSONA_ORDER.length)%PERSONA_ORDER.length]]; }function render(playSfx = true){const left  = at(idx-1), mid = at(idx), right = at(idx+1);pLeft.src = left.portrait; pRight.src = right.portrait; pCenter.src = mid.portrait;pName.textContent = `${mid.name}`;if (playSfx && mid.sfx) { try{ new Audio(mid.sfx).play().catch(()=>{}); }catch{} }}render(true);card.querySelector('#pPrev').onclick = ()=>{ idx--; render(true); };card.querySelector('#pNext').onclick = ()=>{ idx++; render(true); };card.querySelector('#pChoose').onclick = ()=>{const choice = PERSONA_ORDER[(idx+PERSONA_ORDER.length)%PERSONA_ORDER.length];state.persona = choice; save(); alert(CONFIG.persona.options[choice].desc || '–í—ã–±—Ä–∞–Ω –æ–±–ª–∏–∫.'); modal.remove();};card.querySelector('#pClose').onclick = ()=> modal.remove();}
function openInventoryModal() {
    console.log('–û—Ç–∫—Ä—ã—Ç–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è');
    
    
    let modal = document.querySelector('.main-menu.inventory-modal');
    if (modal) {
        console.log('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —É–∂–µ –æ—Ç–∫—Ä—ã—Ç');
        return;
    }
    
    
    modal = document.createElement('div');
    modal.className = 'main-menu inventory-modal'; 
    
    const card = document.createElement('div');
    card.className = 'menu-card';
    card.style.maxWidth = '620px';
    card.innerHTML = `
        <h1>–î–∏–ø–ª–æ–º–∞—Ç</h1>
        <div id="invModalGrid" class="grid" style="background:#2a1f14 url('assets/img/diplomat_leather.jpg') center/cover no-repeat;border:4px solid #3b2a1a;border-radius:16px;padding:12px"></div>
    `;
    
    const close = document.createElement('button');
    close.className = 'btn';
    close.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
    close.onclick = () => {
        console.log('üö™ –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è');
        modal.remove();
    };
    
    card.appendChild(close);
    modal.appendChild(card);
    document.body.appendChild(modal);
    
    
    const g = card.querySelector('#invModalGrid');
    const cells = CONFIG.inventory.cols * CONFIG.inventory.rows;
    for (let i = 0; i < cells; i++) {
        const c = document.createElement('div');
        c.className = 'cell';
        g.appendChild(c);
    }
    
    CONFIG.objects.filter(o => state.taken.includes(o.id)).forEach((o, idx) => {
        const cell = g.children[idx];
        if (!cell) return;
        const im = document.createElement('img');
        im.src = o.img;
        cell.appendChild(im);
    });
    
    console.log('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –æ—Ç–∫—Ä—ã—Ç');
}



function openEpisodesModal(){const modal=document.createElement('div'); modal.className='main-menu';const card=document.createElement('div'); card.className='menu-card'; card.style.maxWidth='560px';card.innerHTML = `<h1>–≠–ø–∏–∑–æ–¥—ã</h1><div id="epsList" class="menu-grid"></div>`;const list = card.querySelector('#epsList');CONFIG.episodesList.forEach(ep=>{const b=document.createElement('button'); b.className='btn'; b.textContent=ep.title + (ep.unlocked?'':' üîí');b.onclick = ()=>{if (!ep.unlocked) { alert('–≠–ø–∏–∑–æ–¥ –µ—â—ë –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'); return; }CONFIG.episode.id = ep.id;CONFIG.episode.title = ep.title;CONFIG.dialogue = DIALOGS[ep.id] || DIALOGS.ep1;save(); modal.remove(); closeMenu();};list.appendChild(b);});const close=document.createElement('button'); close.className='btn'; close.textContent='–ó–∞–∫—Ä—ã—Ç—å'; close.onclick=()=>modal.remove();card.appendChild(close); modal.appendChild(card); document.body.appendChild(modal);}
function openAbout(){const modal=document.createElement('div'); modal.className='main-menu';const card=document.createElement('div'); card.className='menu-card';card.innerHTML = `<h1>–û–± –∞–≤—Ç–æ—Ä–µ</h1><p>–ù–∏–∫–∏—Ç–∞ –û–ª—é—à–∏–Ω ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫ –≤ –¢–ì ¬´–§–∞—Ä–º–∞¬ª.</p><p>–î–ª—è —Å–≤—è–∑–∏: <a href="https://t.me/himyusernameis" target="_blank" style="color:#ffd93b; text-decoration:none;">@himyusernameis</a> (Telegram).</p><p>–î–æ–Ω–∞—Ç—ã –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –Ω–∏ –≤ –∫–∞–∫–æ–º –≤–∏–¥–µ, <u>–Ω–∏ –ø–æ–¥ –∫–∞–∫–∏–º –ø—Ä–µ–¥–ª–æ–≥–æ–º</u></p>`;const close=document.createElement('button'); close.className='btn'; close.textContent='–ó–∞–∫—Ä—ã—Ç—å'; close.onclick=()=>modal.remove();card.appendChild(close); modal.appendChild(card); document.body.appendChild(modal);}



const DISCLAIMER_TEXT = `‚ö†Ô∏è  –î–ò–°–ö–õ–ï–ô–ú–ï–†  ‚ö†Ô∏è 

–≠—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã–º.
–í—Å–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏, —Å–æ–±—ã—Ç–∏—è –∏ –Ω–∞–∑–≤–∞–Ω–∏—è ‚Äî –ø–ª–æ–¥ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞.

–õ—é–±—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ª—é–¥—å–º–∏, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ 
–∏–ª–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ —è–≤–ª—è—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–º–∏.

–ü—Ä–æ–¥–æ–ª–∂–∞—è –∏–≥—Ä—É, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω—ã
—Å –¥–∞–Ω–Ω—ã–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º.`;


function typeWriter(element, text, speed = 30) {
    return new Promise((resolve) => {
        let i = 0;
        element.innerHTML = '';
        
       
        const html = text.replace(/\n/g, '<br>');
        
        function type() {
            if (i < html.length) {
                element.innerHTML = html.substring(0, i + 1);
                i++;
                setTimeout(type, speed);
            } else {
                resolve();
            }
        }
        
        type();
    });
}



function saveResultToFirebase() {
  
  if (state.score <= 0) {
    console.log('‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫: –Ω–µ—Ç –æ—á–∫–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
    return;
  }
  
  if (!state.nickname || state.nickname.trim() === '') {
    console.error('‚ùå –ù–∏–∫–Ω–µ–π–º –Ω–µ —É–∫–∞–∑–∞–Ω!');
    return;
  }

  console.log('üíæ –ò—â—É –∑–∞–ø–∏—Å—å –¥–ª—è –Ω–∏–∫–Ω–µ–π–º–∞:', state.nickname);

 
  database.ref('leaderboard')
    .orderByChild('nickname')
    .equalTo(state.nickname)
    .once('value')
    .then((snapshot) => {
      const result = {
        nickname: state.nickname,
        score: state.score,
        itemsCollected: state.taken.length,
        timestamp: Date.now(),
        date: new Date().toLocaleString('ru-RU')
      };

      if (snapshot.exists()) {
       
        let existingKey = null;
        let existingScore = 0;

        snapshot.forEach((child) => {
          existingKey = child.key;
          existingScore = child.val().score || 0;
        });

        if (state.score > existingScore) {
         
          console.log(`üîÑ –û–±–Ω–æ–≤–ª—è—é —Ä–µ–∫–æ—Ä–¥: ${existingScore} ‚Üí ${state.score}`);
          database.ref('leaderboard/' + existingKey).update(result)
            .then(() => console.log('‚úÖ –†–µ–∫–æ—Ä–¥ –æ–±–Ω–æ–≤–ª—ë–Ω!'))
            .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', err));
        } else {
          console.log(`‚è≠Ô∏è –†–µ–∫–æ—Ä–¥ –Ω–µ –ø–æ–±–∏—Ç (—Ç–µ–∫—É—â–∏–π: ${existingScore}, –Ω–æ–≤—ã–π: ${state.score})`);
        }
      } else {
        
        console.log('‚ûï –°–æ–∑–¥–∞—é –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å');
        database.ref('leaderboard').push(result)
          .then(() => console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!'))
          .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', err));
      }
    })
    .catch((error) => {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
    });
}


function loadLeaderboard() {
  console.log('üìä –ó–∞–≥—Ä—É–∂–∞—é —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤...');

  database.ref('leaderboard')
    .orderByChild('score')
    .limitToLast(30)  
    .once('value')
    .then((snapshot) => {
      const leaders = [];
      
      snapshot.forEach((childSnapshot) => {
        leaders.push(childSnapshot.val());
      });

     
      leaders.reverse();

      console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–≥—Ä–æ–∫–æ–≤:', leaders.length);
      displayLeaderboard(leaders);
    })
    .catch((error) => {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
      alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã: ' + error.message);
    });
}

function displayLeaderboard(leaders) {

  let leaderboardDiv = document.getElementById('leaderboardContent');
  
  if (!leaderboardDiv) {
    console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç leaderboardContent –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    return;
  }

  if (leaders.length === 0) {
    leaderboardDiv.innerHTML = '<p style="text-align:center; color:#888;">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>';
    return;
  }

  let html = '<table style="width:100%; color:var(--text); border-collapse: collapse;">';
  html += '<thead><tr style="border-bottom: 2px solid var(--neon);">';
  html += '<th style="padding:10px; text-align:left;">–ú–µ—Å—Ç–æ</th>';
  html += '<th style="padding:10px; text-align:left;">–ù–∏–∫–Ω–µ–π–º</th>';
  html += '<th style="padding:10px; text-align:center;">–û—á–∫–∏</th>';
  html += '<th style="padding:10px; text-align:center;">–ü—Ä–µ–¥–º–µ—Ç–æ–≤</th>';
  html += '<th style="padding:10px; text-align:right;">–î–∞—Ç–∞</th>';
  html += '</tr></thead><tbody>';

  leaders.forEach((leader, index) => {
    const place = index + 1;
    const medal = place === 1 ? 'ü•á' : place === 2 ? 'ü•à' : place === 3 ? 'ü•â' : place;
    
    html += `<tr style="border-bottom: 1px solid rgba(255,217,59,0.2);">`;
    html += `<td style="padding:10px; font-size:20px;">${medal}</td>`;
    html += `<td style="padding:10px; color:var(--neon);">${leader.nickname}</td>`;
    html += `<td style="padding:10px; text-align:center; font-weight:bold;">${leader.score}</td>`;
    html += `<td style="padding:10px; text-align:center;">${leader.itemsCollected}</td>`;
    html += `<td style="padding:10px; text-align:right; font-size:12px; color:#888;">${leader.date}</td>`;
    html += `</tr>`;
  });

  html += '</tbody></table>';
  leaderboardDiv.innerHTML = html;
}


function load() {
    const s = localStorage.getItem('noirGameState');
    if (!s) return;
    
    try {
        const loaded = JSON.parse(s);
        state.taken = loaded.taken || [];
        state.score = loaded.score || 0;
        state.dialogueIndex = loaded.dialogueIndex || 0;
        state.disclaimerShown = loaded.disclaimerShown || false;
    } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ', e);
    }
}


load();


let safeCombination = [6, 7, 5]; 
let currentPosition = 0; 
let userCombination = [0, 0, 0]; 


function openSafeCrackGame() {
    console.log('üîì –û—Ç–∫—Ä—ã–≤–∞—é –º–∏–Ω–∏-–∏–≥—Ä—É –≤–∑–ª–æ–º–∞ —Å–µ–π—Ñ–∞');
    
    const overlay = document.getElementById('safeCrackOverlay');
    if (!overlay) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç #safeCrackOverlay –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        return;
    }
    
    overlay.style.display = 'flex';
    
   
    currentPosition = 0;
    userCombination = [0, 0, 0];
    
    updateDigitDisplays();
    highlightActiveDigit();
    
    
    setupSafeGameEvents();
}


function setupSafeGameEvents() {
    console.log('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –º–∏–Ω–∏-–∏–≥—Ä—ã');
    
    
    document.querySelectorAll('.disk-arrow').forEach(arrow => {
        arrow.onclick = (e) => {
            e.stopPropagation();
            const diskIndex = parseInt(arrow.dataset.disk);
            const isUp = arrow.classList.contains('disk-up');
            
            console.log(`üîº –°—Ç—Ä–µ–ª–∫–∞ ${isUp ? '–≤–≤–µ—Ä—Ö' : '–≤–Ω–∏–∑'} –¥–ª—è –¥–∏—Å–∫–∞ ${diskIndex}`);
            
            changeDiskValue(diskIndex, isUp ? 1 : -1);
            
            
        };
    });
    
    
    document.querySelectorAll('.digit-display').forEach((digit, index) => {
        digit.onclick = () => {
            console.log('üîò –í—ã–±—Ä–∞–Ω–∞ –ø–æ–∑–∏—Ü–∏—è:', index);
            currentPosition = index;
            highlightActiveDigit();
           
        };
    });
    
    
    const submitBtn = document.getElementById('safeCrackSubmit');
    if (submitBtn) {
        submitBtn.onclick = () => {
            console.log('üîò –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å"');
            checkSafeCombination();
        };
    }
    
    
    const closeBtn = document.getElementById('safeCrackClose');
    if (closeBtn) {
        closeBtn.onclick = () => {
            console.log('üîò –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å"');
            closeSafeCrackGame();
        };
    }
    
   
    const overlay = document.getElementById('safeCrackOverlay');
    overlay.onclick = (e) => {
        if (e.target === overlay) {
            closeSafeCrackGame();
        }
    };
}


function changeDiskValue(diskIndex, delta) {
    userCombination[diskIndex] = (userCombination[diskIndex] + delta + 10) % 10;
    updateDigitDisplays();
    console.log('üìä –ö–æ–º–±–∏–Ω–∞—Ü–∏—è:', userCombination);
}


function closeSafeCrackGame() {
    console.log('‚ùå –ó–∞–∫—Ä—ã–≤–∞—é –º–∏–Ω–∏-–∏–≥—Ä—É');
    document.getElementById('safeCrackOverlay').style.display = 'none';
}


function updateDigitDisplays() {
    document.getElementById('digit1').textContent = userCombination[0];
    document.getElementById('digit2').textContent = userCombination[1];
    document.getElementById('digit3').textContent = userCombination[2];
}


function highlightActiveDigit() {
    const digits = document.querySelectorAll('.digit-display');
    
    digits.forEach((digit, index) => {
        if (index === currentPosition) {
            digit.classList.add('active');
        } else {
            digit.classList.remove('active');
        }
    });
}


function checkSafeCombination() {
    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:', userCombination, 'vs', safeCombination);
    
    const isCorrect = userCombination.every((digit, index) => digit === safeCombination[index]);
    
    if (isCorrect) {
        console.log('‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ö–û–ú–ë–ò–ù–ê–¶–ò–Ø!');
        onSafeCracked();
    } else {
        console.log('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è');
        
        // –¢—Ä—è—Å–∫–∞ –æ–∫–Ω–∞
        const window = document.querySelector('.safeCrack-window');
        window.classList.add('shake');
        
        // –ó–≤—É–∫ –æ—Ç–∫–∞–∑–∞
       
        
        setTimeout(() => {
            window.classList.remove('shake');
        }, 400);
    }
}


function onSafeCracked() {
    console.log('‚úÖ –°–µ–π—Ñ –≤–∑–ª–æ–º–∞–Ω!');
    if (state.safeCracked) {
        console.log('‚ö†Ô∏è –°–µ–π—Ñ —É–∂–µ –±—ã–ª –≤–∑–ª–æ–º–∞–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤');
        return;
    }
    console.log('üìç –¢–µ–∫—É—â–∏–π —ç–ø–∏–∑–æ–¥:', CONFIG.episode.id);
    console.log('üíæ state.dialogueIndex:', state.dialogueIndex);
    console.log('üìä CONFIG.dialogue.length:', CONFIG.dialogue.length);
    
 
    state.safeCracked = true;
    save();
    
   
    closeSafeCrackGame();
    
   
    const safeObj = CONFIG.objects.find(obj => obj.id === 'safe' && obj.episode === 'ep6');
    if (safeObj) {
        safeObj.img = 'assets/img/vault_open3.png';
       
    safeObj.scale = 1.1; 
    console.log('üîÑ –°–µ–π—Ñ –æ—Ç–∫—Ä—ã—Ç, scale —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', safeObj.scale);

    }
    
    
    
const condomObj = CONFIG.objects.find(
  obj => obj.id === '–ö–æ–Ω—Ç—Ä–æ—Ü–µ–ø—Ç–∏–≤' && obj.episode === 'ep6'
);
if (condomObj) {
  condomObj.visible = true; 
}

    
    
    renderObjects();

   
    
    alert('–°–µ–π—Ñ –æ—Ç–∫—Ä—ã—Ç! –í–Ω—É—Ç—Ä–∏ –ª–µ–∂–∏—Ç –∫–æ–Ω—Ç—Ä–∞—Ü–µ–ø—Ç–∏–≤...');
      playSfx('assets/audio/sfx_you_win.mp3');


if (CONFIG.episode.id === 'ep6') {
  console.log('üîÅ –°–µ–π—Ñ –≤–∑–ª–æ–º–∞–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–ø–∏–∑–æ–¥ 7');
  
  setTimeout(() => {
    window.onEpisodeComplete();
  }, 7000); 
}

}



function initSafeCrackEvents() {
    // –°–∫—Ä–æ–ª–ª –Ω–∞ –∫–æ–ª–µ—Å–µ
    const diskWheel = $('#diskWheel');
    if (diskWheel) {
        diskWheel.addEventListener('wheel', handleDiskScroll, { passive: false });
        diskWheel.addEventListener('click', selectNextPosition);
    }
    
    // –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å"
    const submitBtn = $('#safeCrackSubmit');
    if (submitBtn) {
        submitBtn.addEventListener('click', checkSafeCombination);
    }
    
    // –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å"
    const closeBtn = $('#safeCrackClose');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeSafeCrackGame);
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
    const overlay = $('#safeCrackOverlay');
    if (overlay) {
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                closeSafeCrackGame();
            }
        });
    }
}


// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ñ–µ-–º–∞—à–∏–Ω—ã
const COFFEE_RECIPE = {
  order: ['coffee', 'water', 'milk', 'cinnamon', 'syrup'],
  images: {
    0: 'assets/img/coffe_cup_empty.png',
    1: 'assets/img/coffe_cup_coffee.png',      
    2: 'assets/img/coffe_cup_coffee.png',
    3: 'assets/img/coffe_cup_milk.png',        
    4: 'assets/img/coffe_cup_cinnamon.png',    
    5: 'assets/img/coffe_cup_syrup.png',       
    6: 'assets/img/coffe_cup_syrup.png'     
  },
  names: {
    coffee: '–∫–æ—Ñ–µ',
    water: '–≤–æ–¥—É',
    milk: '–º–æ–ª–æ–∫–æ',
    cinnamon: '–∫–æ—Ä–∏—Ü—É',
    syrup: '—Å–∏—Ä–æ–ø'
    
  }
};

let coffeeState = {
  added: [],
  currentStep: 0
};


function showCoffeeGame() {
  console.log('‚òï –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ—Ñ–µ-–º–∞—à–∏–Ω—ã');
  
  const game = document.getElementById('coffeeGame');
  game.style.display = 'flex';
  
  
  coffeeState.added = [];
  coffeeState.currentStep = 0;
  
  updateCoffeeCup();
  updateProgress();
  updateHint();
  
  
  document.querySelectorAll('.ingredient').forEach(ing => {
    ing.classList.remove('used');
  });
  
  
  const cupArea = document.querySelector('.coffee-cup-area');
  const ingredients = document.querySelectorAll('.ingredient');
  
  ingredients.forEach(ing => {
    ing.addEventListener('dragstart', handleDragStart);
    ing.addEventListener('dragend', handleDragEnd);
  });
  
  cupArea.addEventListener('dragover', handleDragOver);
  cupArea.addEventListener('dragleave', handleDragLeave);
  cupArea.addEventListener('drop', handleDrop);
}


function closeCoffeeGame() {
  const game = document.getElementById('coffeeGame');
  game.style.display = 'none';
}


let draggedIngredient = null;

function handleDragStart(e) {
  draggedIngredient = e.target.closest('.ingredient').dataset.ingredient;
  e.target.closest('.ingredient').style.opacity = '0.5';
  console.log('üéØ –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è:', draggedIngredient);
}

function handleDragEnd(e) {
  e.target.closest('.ingredient').style.opacity = '1';
}

function handleDragOver(e) {
  e.preventDefault();
  
  const glow = document.getElementById('cupGlow');
  glow.classList.add('active');
}

function handleDragLeave(e) {
  const glow = document.getElementById('cupGlow');
  glow.classList.remove('active');
}

function handleDrop(e) {
  e.preventDefault();
  
  const glow = document.getElementById('cupGlow');
  glow.classList.remove('active');
  
  if (!draggedIngredient) return;
  
  
  const expectedIngredient = COFFEE_RECIPE.order[coffeeState.currentStep];
  
  if (draggedIngredient !== expectedIngredient) {
    console.log('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç! –û–∂–∏–¥–∞–µ—Ç—Å—è:', expectedIngredient);
    showError(`–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ ${COFFEE_RECIPE.names[expectedIngredient]}!`);
    return;
  }
  
  
  console.log('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω:', draggedIngredient);
  coffeeState.added.push(draggedIngredient);
  coffeeState.currentStep++;
  
  
  const ingElement = document.querySelector(`.ingredient[data-ingredient="${draggedIngredient}"]`);
  if (ingElement) ingElement.classList.add('used');
  
  
  updateCoffeeCup();
  updateProgress();
  updateHint();
  
  
  if (coffeeState.currentStep === 5) {
    setTimeout(() => {
      completeCoffeeGame();
    }, 800);
  }
  
  draggedIngredient = null;
}


function updateCoffeeCup() {
  const cup = document.getElementById('coffeeCup');
  const step = coffeeState.currentStep;
  
  
  cup.classList.add('pour');
  setTimeout(() => cup.classList.remove('pour'), 500);
  
 
  cup.src = COFFEE_RECIPE.images[step];
  
  console.log('‚òï –®–∞–≥:', step, 'PNG:', cup.src);
}


function updateProgress() {
  const progress = document.getElementById('coffeeProgress');
  progress.textContent = `${coffeeState.currentStep}/5`;
  
  if (coffeeState.currentStep >= 3) {
    progress.style.color = '#ffd93b';
  }
  if (coffeeState.currentStep === 5) {
    progress.style.color = '#4ade80';
  }
}


function updateHint() {
  const hint = document.querySelector('.coffee-hint');
  
  if (coffeeState.currentStep < 5) {
    const nextIngredient = COFFEE_RECIPE.order[coffeeState.currentStep];
    hint.textContent = `–¢–µ–∫—É—â–∏–π —à–∞–≥: –¥–æ–±–∞–≤—å—Ç–µ ${COFFEE_RECIPE.names[nextIngredient]}`;
    hint.style.color = '#ffd93b';
  } else {
    hint.textContent = '–ö–æ—Ñ–µ –≥–æ—Ç–æ–≤! –í—ã –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã!';
    hint.style.color = '#4ade80';
  }
}


function showError(text) {
  const hint = document.querySelector('.coffee-hint');
  const originalText = hint.textContent;
  const originalColor = hint.style.color;
  
  hint.textContent = '‚ùå ' + text;
  hint.style.color = '#ff6b6b';
  
  
  const cup = document.getElementById('coffeeCup');
  cup.style.animation = 'shake 0.4s ease';
  
  setTimeout(() => {
    hint.textContent = originalText;
    hint.style.color = originalColor;
    cup.style.animation = '';
  }, 1500);
}


function completeCoffeeGame() {
  console.log('üéâ –ö–æ—Ñ–µ –≥–æ—Ç–æ–≤!');
  
  const hint = document.querySelector('.coffee-hint');
  hint.textContent = '‚úÖ –ö–æ—Ñ–µ –≥–æ—Ç–æ–≤! –ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!';
  hint.style.color = '#4ade80';
  hint.style.fontSize = '18px';
  hint.style.fontWeight = 'bold';
  
  
  setTimeout(() => {
    closeCoffeeGame();
    
   
    state.dialogueIndex++;
    save();
    stepDialogue();
  }, 2000);
}




function wireUI() {
   
    const btnContinue = document.getElementById('btnContinue');
    if (btnContinue) {
        btnContinue.onclick = () => {
            const nickInput = document.getElementById('nickname');
            const n = (nickInput?.value || state.nickname || 'Player').trim();
            if (!validNick(n)) return alert('–ù–∏–∫: –ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã/_ , 3‚Äì16');
            state.nickname = n;
            save();
            closeMenu();
        };
    }
    
    const btnNew = document.getElementById('btnNew');
if (btnNew) {
  btnNew.onclick = async () => {
    if (!confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É?')) return;
    
    
    const nickInput = document.getElementById('nickname');
    const n = (nickInput?.value || state.nickname || 'Player').trim();
    if (!validNick(n)) return alert('–ù–∏–∫: –ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã/_ , 3‚Äì16');
    
    console.log('üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞');
    
    
    state.nickname = n;
    state.score = 0;
    state.taken = [];
    state.dialogueIndex = 0;
    state.disclaimerShown = false;
    state.scene = 'ep1';

    CONFIG.episode = {
      id: 'ep1',
      title: '–≠–ø–∏–∑–æ–¥ 1',
      bg: 'assets/img/hall_back.png',
      music: 'assets/audio/music_ep1.mp3'
    };
    CONFIG.dialogue = DIALOGS.ep1;
    
    save();
    buildInventory();        
    loadScene();
    renderObjects();
    closeMenu();

     await showDisclaimer();
  };
}
  
    
    initSafeCrackEvents();
    
    const btnPersona = document.getElementById('btnPersona');
    if (btnPersona) {
        btnPersona.onclick = openPersonaCarousel;
    }
    
    const btnInv = document.getElementById('btnInventory');
    if (btnInv) {
        btnInv.onclick = () => {
            console.log('üéí –ö–ª–∏–∫ –ø–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—é');
            openInventoryModal();
        };
    }
    
    const btnAbout = document.getElementById('btnAbout');
    if (btnAbout) {
        btnAbout.onclick = openAbout;
    }
    
    const btnEditor = document.getElementById('btnEditor');
    if (btnEditor) {
        btnEditor.onclick = (e) => {
            state.editor = !state.editor;
            e.target.textContent = `–†–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–π: ${state.editor ? '–≤–∫–ª' : '–≤—ã–∫–ª'}`;
        };
    }
    
    
    window.addEventListener('click', (e) => {
      
        if (e.target.closest('.btn') || e.target.closest('.ctx') || e.target.closest('.obj')) {
            return;
        }
        closeContext();
    });
    
    const btnInvToggle = document.getElementById('btnInvToggle');
    if (btnInvToggle) {
        btnInvToggle.onclick = () => {
            const inv = document.getElementById('inv');
            inv.classList.toggle('open');
        };
    }
    
    const btnMenu = document.getElementById('btnMenu');
    if (btnMenu) {
        btnMenu.onclick = () => {
            const dlg = document.getElementById('dialog');
            if (dlg) dlg.style.display = 'none';
            
            const m = document.getElementById('mainMenu');
            m.style.display = 'grid';
            m.hidden = false;
            document.body.classList.add('menu-open');
            
            music.pause();
            playMenuMusic();
        };
    }
const btnLeaders = document.getElementById('btnLeaders');
if (btnLeaders) {
  btnLeaders.addEventListener('click', openLeaderboard);
  console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ "–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤" –ø–æ–¥–∫–ª—é—á–µ–Ω–∞');
}
}

window.addEventListener('DOMContentLoaded', () => {
    wireUI();
});


    
   



let soundEnabled = true;
document.getElementById('btnSound')?.addEventListener('click', (e) => {
  soundEnabled = !soundEnabled;
  music.volume = soundEnabled ? 0.6 : 0;
  e.target.textContent = soundEnabled ? 'üîä' : 'üîá';
});

function init(){document.body.classList.add('menu-open');loadScene(); buildInventory(); renderObjects();wireUI();openMenu();}
document.addEventListener('DOMContentLoaded', init);

let dialogueReady = false;
document.addEventListener('click', (e) => {
  if (e.target.closest('#dialog') && !e.target.closest('.btn') && !e.target.closest('.choices')) {
    const node = CONFIG.dialogue[state.dialogueIndex];
    if (node && !node.choices) {
      state.dialogueIndex++;
      save();
      stepDialogue();
    }
  }
});

document.addEventListener('keydown', (e) => {
  if (e.code === 'Space' && !document.body.classList.contains('menu-open')) {
    e.preventDefault();
    
    const node = CONFIG.dialogue[state.dialogueIndex];
    if (!node || node.choices) return;
    
   
    if (currentTypeTimer) {
      clearInterval(currentTypeTimer);
      currentTypeTimer = null;
      const dlgText = document.getElementById('dialogText');
      if (dlgText) dlgText.textContent = node.text;
    } else {
      
      state.dialogueIndex++;
      save();
      stepDialogue();
    }
  }
});



function checkEpisode6Complete() {
  const allDialoguesHeard = state.dialogueIndex >= CONFIG.dialogue.length;
  const safeCracked = !!state.safeCracked;

  console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ø–∏–∑–æ–¥–∞ 6:', {
    allDialoguesHeard,
    safeCracked,
    dlgIndex: state.dialogueIndex,
    totalDlg: CONFIG.dialogue.length
  });

  if (!allDialoguesHeard) {
    return false;
  }

  if (allDialoguesHeard && !safeCracked) {

  alert('–ú–∞—Ç—Ä–∏–∫—Å: –Ø –æ–±—è–∑–∞–Ω –≤—Å–∫—Ä—ã—Ç—å —ç—Ç–æ—Ç —Å–µ–π—Ñ –∏ —É–∑–Ω–∞—Ç—å, —á—Ç–æ —Ç–∞–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è.'); 
  return false;
}


  return true;
}

// –ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —ç–ø–∏–∑–æ–¥–∞–º–∏
window.EP_ORDER = ['ep1','ep2','ep3','ep4','ep5','ep6','ep7','ep8'];



window.onEpisodeComplete = function(){
  console.log('üé¨ Episode complete! Current:', CONFIG.episode.id);
  
  const cur = CONFIG.episode.id;
  const idx = window.EP_ORDER.indexOf(cur);
  const nextId = window.EP_ORDER[idx + 1];
  
  console.log('‚û°Ô∏è Next episode:', nextId);
  
  
  if (!nextId) {
    console.log('üéâ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é');
    
    const overlay = document.getElementById('transitionOverlay');
    overlay.classList.add('active'); // –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ
    
    setTimeout(() => {
    
      location.reload(); 
    }, 1500); 
    
    return;
  }

  
  if (cur === 'ep2') {
    console.log('üîí –≠–ø–∏–∑–æ–¥ 2 –∑–∞–≤–µ—Ä—à—ë–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–º–æ–∫');
    showDoorLock();
    return;
  }
  
  
  if (cur === 'ep6') {
    if (!checkEpisode6Complete()) {
      console.log('‚ö†Ô∏è –≠–ø–∏–∑–æ–¥ 6: —Å–µ–π—Ñ –Ω–µ –≤—Å–∫—Ä—ã—Ç, –±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ö–æ–¥');
      return;
    }
    
    console.log('‚è≥ –ñ–¥—ë–º 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ ep7...');
    setTimeout(() => {
      fadeOutAndLoadEpisode(nextId, idx); 
    }, 5000);
    
    return;
  }
  
  
  fadeOutAndLoadEpisode(nextId, idx);
};


function loadNextEpisode(nextId, idx) {
  if (nextId && DIALOGS[nextId]) {
    console.log('‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–ø–∏–∑–æ–¥:', nextId);
    
    const epEntry = CONFIG.episodesList.find(e => e.id === nextId);
    if (epEntry) epEntry.unlocked = true;
    
    CONFIG.episode.id = nextId;
    CONFIG.episode.title = `–≠–ø–∏–∑–æ–¥ ${idx + 2}`;
    CONFIG.episode.bg = EPISODE_BACKGROUNDS[nextId] || 'assets/img/hall_back.png';
    CONFIG.episode.music = EPISODE_MUSIC[nextId] || 'assets/audio/music_ep1.mp3';
    CONFIG.dialogue = DIALOGS[nextId];
    
    console.log('üì¶ CONFIG –æ–±–Ω–æ–≤–ª—ë–Ω:', CONFIG.episode);
    
    state.dialogueIndex = 0;
    save();
    
    loadScene();
    renderObjects();
    playEpisodeMusic(CONFIG.episode.music);
    showEpisodeTitle();
    
    setTimeout(() => {
      console.log('üí¨ –ü–æ–∫–∞–∑—ã–≤–∞—é –¥–∏–∞–ª–æ–≥ —á–µ—Ä–µ–∑ 500–º—Å');
      renderObjects();
      const dlg = document.getElementById('dialog');
      if (dlg) {
        dlg.style.cssText = 'position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); display: flex !important; visibility: visible !important; z-index: 35;';
      }
      stepDialogue();
    }, 500);
  } else {
    console.log('‚ùå –ù–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ø–∏–∑–æ–¥–∞ –∏–ª–∏ –¥–∏–∞–ª–æ–≥–∞');
  }
}




// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —ç–ø–∏–∑–æ–¥–æ–≤
if(typeof window.EPCONFIG === 'undefined'){
  window.EPCONFIG = {
    ep1: { 
      id:'ep1', 
      title:'–≠–ø–∏–∑–æ–¥ 1', 
      bg:'assets/img/hallback.png', 
      music:'assets/audio/music_ep1.mp3', 
      dlg: DIALOGS.ep1 
    },
    ep2: { 
      id:'ep2', 
      title:'–≠–ø–∏–∑–æ–¥ 2', 
      bg:'assets/img/lyuba_pic3.png', 
      music:'assets/audio/music_ep2.mp3', 
      dlg: DIALOGS.ep2 
    },
    ep3: { 
      id:'ep3', 
      title:'–≠–ø–∏–∑–æ–¥ 3', 
      bg:'assets/img/kitchen.png', 
      music:'assets/audio/music_ep3.mp3', 
      dlg: DIALOGS.ep3 
    },
    ep4: { 
      id:'ep4', 
      title:'–≠–ø–∏–∑–æ–¥ 4', 
      bg:'assets/img/security.png', 
      music:'assets/audio/music_ep4.mp3', 
      dlg: DIALOGS.ep4 
    },
    ep5: { 
      id:'ep5', 
      title:'–≠–ø–∏–∑–æ–¥ 5', 
      bg:'assets/img/king_filipp.png', 
      music:'assets/audio/music_ep5.mp3', 
      dlg: DIALOGS.ep5 
    },
    ep6: { 
      id:'ep6', 
      title:'–≠–ø–∏–∑–æ–¥ 6', 
      bg:'assets/img/willi_back2.png', 
      music:'assets/audio/music_ep6.mp3', 
      dlg: DIALOGS.ep6 
    },
    ep7: { 
      id:'ep7', 
      title:'–≠–ø–∏–∑–æ–¥ 7', 
      bg:'assets/img/os_back.png', 
      music:'assets/audio/music_ep7.mp3', 
      dlg: DIALOGS.ep7 
    },
    ep8: { 
      id:'ep8', 
      title:'–≠–ø–∏–∑–æ–¥ 8', 
      bg:'assets/img/smoking.png', 
      music:'assets/audio/music_ep8.mp3', 
      dlg: DIALOGS.ep8 
    }
  };
  window.EPORDER = ['ep1','ep2','ep3','ep4','ep5','ep6','ep7','ep8'];
}


// –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —ç–ø–∏–∑–æ–¥
window.startEpisode = function(epId){
  epId = epId || 'ep1';
  
  
  const ep = window.EPCONFIG ? window.EPCONFIG[epId] : null;
  if(!ep) {
    console.error('–≠–ø–∏–∑–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω:', epId);
    return;
  }
  
 
  CONFIG.episode.id = ep.id;
  CONFIG.episode.title = ep.title;
  CONFIG.episode.bg = ep.bg;
  CONFIG.episode.music = ep.music;
  CONFIG.dialogue = ep.dlg;
  
  
  if(window.state) state.dialogueIndex = 0;
  
  
  const m = document.getElementById('mainMenu');
  if(m) {
    m.hidden = true;
    document.body.classList.remove('menu-open');
  }
  
  
  loadScene();
  renderObjects();
  buildInventory();
  playEpisodeMusic(CONFIG.episode.music);
  showDialogue();
  showEpisodeTitle();
  save();
};


let resizeTimer;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
        console.log('üîÑ Window resized, updating cache...');
        cacheSceneDimensions(); 
        renderObjects();
    }, 100);
});


function openLeaderboard() {
  console.log('üìä –û—Ç–∫—Ä—ã–≤–∞—é —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤');
  
  const modal = document.getElementById('leaderboardModal');
  if (modal) {
    modal.style.display = 'flex';
    loadLeaderboard(); 
  }
}


function closeLeaderboard() {
  console.log('‚ùå –ó–∞–∫—Ä—ã–≤–∞—é —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤');
  
  const modal = document.getElementById('leaderboardModal');
  if (modal) {
    modal.style.display = 'none';
  }
}


</script>

<!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ –≤–∑–ª–æ–º–∞ —Å–µ–π—Ñ–∞ -->
<div id="safeCrackOverlay" class="minigame-overlay" style="display:none;">
    <div class="safeCrack-window">
        <h2>–í–∑–ª–æ–º –∫–æ–¥–æ–≤–æ–≥–æ –∑–∞–º–∫–∞</h2>
        
        <div class="combination-container">
            <!-- –ü–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞ -->
            <div class="disk-column">
                <button class="disk-arrow disk-up" data-disk="0">‚ñ≤</button>
                <div class="digit-display active" id="digit1" data-disk="0">0</div>
                <button class="disk-arrow disk-down" data-disk="0">‚ñº</button>
            </div>
            
            <!-- –í—Ç–æ—Ä–∞—è —Ü–∏—Ñ—Ä–∞ -->
            <div class="disk-column">
                <button class="disk-arrow disk-up" data-disk="1">‚ñ≤</button>
                <div class="digit-display" id="digit2" data-disk="1">0</div>
                <button class="disk-arrow disk-down" data-disk="1">‚ñº</button>
            </div>
            
            <!-- –¢—Ä–µ—Ç—å—è —Ü–∏—Ñ—Ä–∞ -->
            <div class="disk-column">
                <button class="disk-arrow disk-up" data-disk="2">‚ñ≤</button>
                <div class="digit-display" id="digit3" data-disk="2">0</div>
                <button class="disk-arrow disk-down" data-disk="2">‚ñº</button>
            </div>
        </div>
        
        <div class="instruction">
            üí° <strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> –°—Ç—Ä–µ–ª–∫–∏ ‚ñ≤‚ñº ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å —Ü–∏—Ñ—Ä—É | –ö–ª–∏–∫ –Ω–∞ —Ü–∏—Ñ—Ä—É ‚Äî –≤—ã–±—Ä–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é
        </div>
        
        <div class="safeCrack-buttons">
            <button id="safeCrackSubmit" class="btn-primary">–û—Ç–∫—Ä—ã—Ç—å</button>
            <button id="safeCrackClose" class="btn-secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞: –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ñ–µ -->
<div id="coffeeGame" class="coffee-game" style="display:none;">
  <div class="coffee-overlay"></div>
  <div class="coffee-container">
    <h2>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ñ–µ</h2>
    <p class="coffee-hint">–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –¥–æ–±–∞–≤—å—Ç–µ –∫–æ—Ñ–µ</p>
    
    <!-- –°—Ç–∞–∫–∞–Ω—á–∏–∫ –≤ —Ü–µ–Ω—Ç—Ä–µ -->
    <div class="coffee-cup-area">
      <img id="coffeeCup" src="assets/img/cup_empty.png" class="coffee-cup" alt="–°—Ç–∞–∫–∞–Ω—á–∏–∫">
      <div id="cupGlow" class="cup-glow"></div>
    </div>
    
    <!-- –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã -->   
        <div class="coffee-ingredients">
      <div class="ingredient" draggable="true" data-ingredient="cinnamon">
        <img src="assets/img/ingredient_cinnamon.png" alt="–ö–æ—Ä–∏—Ü–∞">
        <span>–ö–æ—Ä–∏—Ü–∞</span>
      </div>

       <div class="ingredient" draggable="true" data-ingredient="water">
        <img src="assets/img/ingredient_water.png" alt="–í–æ–¥–∞">
        <span>–í–æ–¥–∞</span>
      </div>

      <div class="ingredient" draggable="true" data-ingredient="milk">
        <img src="assets/img/ingredient_milk.png" alt="–ú–æ–ª–æ–∫–æ">
        <span>–ú–æ–ª–æ–∫–æ</span>
      </div>
      
      <div class="ingredient" draggable="true" data-ingredient="syrup">
        <img src="assets/img/ingredient_syrup.png" alt="–°–∏—Ä–æ–ø">
        <span>–°–∏—Ä–æ–ø</span>
      </div>

    
      <div class="ingredient" draggable="true" data-ingredient="coffee">
        <img src="assets/img/ingredient_coffee.png" alt="–ö–æ—Ñ–µ">
        <span>–ö–æ—Ñ–µ</span>
      </div>
      </div>
      
    
    <p class="coffee-status">–î–æ–±–∞–≤–ª–µ–Ω–æ: <span id="coffeeProgress">0/5</span></p>
  </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —ç–ø–∏–∑–æ–¥–∞–º–∏ -->
<div id="transitionOverlay" class="transition-overlay"></div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ -->
<div class="leaderboard-modal" id="leaderboardModal" style="display:none;">
  <div class="leaderboard-container">
    <div class="leaderboard-header">
      <h2>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
      <button class="close-btn" onclick="closeLeaderboard()">‚úï</button>
    </div>
    <div class="leaderboard-content" id="leaderboardContent">
      <p style="text-align:center; color:#888;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>
  </div>
</div>


</body>
</html>
